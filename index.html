<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiscord</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Consolas:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Default Discord-like colors */
            --bg-tertiary: #202225;
            --bg-secondary: #2f3136;
            --bg-primary: #36393f;
            --text-normal: #dcddde;
            --text-header: #ffffff;
            --interactive-normal: #b9bbbe;
            --interactive-hover: #dcddde;
            --interactive-active: #ffffff;
            --blurple: #5865F2;
            --blurple-hover: #4752c4;
            --green: #3ba55c;
            --red: #ed4245;
            --yellow: #faa61a;
            --pink: #eb459e;
            --font-main: 'Inter', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-primary);
            color: var(--text-normal);
            overflow: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background-color: var(--bg-tertiary); }
        .custom-scrollbar::-webkit-scrollbar-thumb { 
            background-color: #1a1b1e; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: #2c2f33; }

        /* Animations */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(235, 69, 158, 0.3); }
            50% { box-shadow: 0 0 15px rgba(235, 69, 158, 0.6); }
        }
        .pulse-glow { animation: pulse-glow 2s infinite; }

        .library-item:hover { background: rgba(79, 84, 92, 0.3); }
        .modal-backdrop { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(3px); transition: opacity 0.3s ease; }

        /* Command Prompt Look */
        .cmd-window {
            font-family: 'Consolas', monospace;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .cmd-header {
            background: #ffffff;
            color: #000;
            padding: 2px 10px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ccc;
        }
        .cmd-body {
            background-color: #0c0c0c;
            color: #cccccc;
            padding: 5px;
            height: 400px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.5;
        }
        .cmd-cursor {
            display: inline-block;
            width: 8px;
            height: 14px;
            background: #cccccc;
            animation: blink 1s infinite;
            vertical-align: text-bottom;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Typing cursor for confession */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: var(--pink);
            margin-left: 2px;
        }

        /* Dynamic Progress Bar */
        .progress-bar-dynamic {
            height: 100%;
            background: linear-gradient(90deg, var(--blurple), var(--pink));
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(235, 69, 158, 0.5);
            position: relative;
            overflow: hidden;
        }
        .progress-bar-dynamic::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col md:flex-row text-sm select-none transition-colors duration-300">

    <!-- AUDIO PLAYER PLACEHOLDERS -->
    <!-- <audio id="audio-final-countdown" src="The_Final_Countdown.mp3" preload="auto"></audio>
    <audio id="audio-divka" src="D√≠vka_s_perlami_ve_vlasech.mp3" preload="auto"></audio> -->

    <!-- ========== INITIAL SCREENS ========== -->
    
    <!-- Screen 1: Login -->
    <div id="login-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-[#36393f] flex-col">
        <div class="bg-[#2f3136] p-10 rounded-xl shadow-2xl w-full max-w-md text-center transform transition-all" id="login-box">
            <div class="mb-6">
                <div class="text-6xl mb-2">ü¶â‚ù§Ô∏èüêô</div>
                <div class="text-xs text-gray-400">Kiscord Auth System v1.0</div>
            </div>
            <h1 class="text-2xl font-bold text-white mb-2">Server Autentifikace</h1>
            <p class="text-gray-400 mb-8">Pro vstup je vy≈æadov√°no ovƒõ≈ôen√≠ re√°ln√© polohy.</p>
            
            <button id="verify-btn" onclick="verifyLocation()" class="w-full bg-[#5865F2] hover:bg-[#4752c4] text-white font-bold py-4 rounded-lg transition-all flex items-center justify-center gap-3 text-lg group shadow-lg">
                <i class="fas fa-satellite-dish group-hover:rotate-12 transition"></i>
                <span id="verify-text">Ovƒõ≈ôit polohu</span>
            </button>

            <div id="verify-status" class="mt-6 text-left hidden space-y-2 font-mono text-xs bg-[#202225] p-3 rounded">
                <div class="flex items-center gap-2 text-gray-400">
                    <i class="fas fa-circle-notch fa-spin"></i> Skenov√°n√≠ satelit≈Ø...
                </div>
            </div>
        </div>
    </div>

    <!-- Screen 2: Fact Checker Quiz -->
    <div id="quiz-screen" class="fixed inset-0 z-40 hidden bg-[#36393f] flex-col items-center justify-center p-4">
        <div class="bg-[#2f3136] rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden border border-[#202225] flex flex-col h-[700px]">
            <!-- Header -->
            <div class="p-6 bg-[#202225] border-b border-[#2f3136] flex items-center gap-4">
                <div class="w-12 h-12 rounded-full bg-[#5865F2] flex items-center justify-center text-white text-xl shadow-lg">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-white">Security Fact-Check</h2>
                    <p class="text-gray-400 text-sm">Verification Protocol</p>
                </div>
            </div>

            <!-- Quiz Content -->
            <div class="flex-1 p-8 flex flex-col justify-start pt-20 relative bg-[#36393f] overflow-y-auto">
                <div id="quiz-container" class="w-full">
                    <!-- Questions injected here -->
                </div>

                <!-- Fun Fact Area -->
                <div class="mt-auto pt-8 pb-2" id="fun-fact-container" style="display:none;">
                    <div class="border-t border-[#4f545c] pt-4 text-center opacity-70 hover:opacity-100 transition">
                         <div class="flex justify-center items-center gap-2 mb-1">
                            <span class="text-lg">üí°</span>
                            <h4 class="font-bold text-[#b9bbbe] text-xs uppercase tracking-widest">Bonus Fun Fact</h4>
                        </div>
                        <p class="text-gray-400 text-sm italic" id="fun-fact-text">Naƒç√≠t√°n√≠ zaj√≠mavosti...</p>
                    </div>
                </div>
            </div>

            <!-- Footer Progress -->
            <div class="p-4 bg-[#2f3136] border-t border-[#202225]">
                <div class="flex justify-between text-xs text-gray-400 mb-2 font-bold tracking-wider">
                    <span>PROGRESS</span>
                    <span id="quiz-step-text">1/10</span>
                </div>
                <div class="h-3 bg-[#202225] rounded-full overflow-hidden border border-[#202225]">
                    <div id="quiz-progress" class="progress-bar-dynamic" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Screen 3: Certificate -->
    <div id="certificate-screen" class="fixed inset-0 z-40 hidden bg-[#36393f] flex-col items-center justify-center p-4">
        <div class="bg-gradient-to-br from-[#2f3136] to-[#202225] border-2 border-[#5865F2] rounded-xl shadow-2xl w-full max-w-xl overflow-hidden p-1">
            <div class="bg-[#2f3136] rounded-lg p-8 text-center">
                <div class="text-5xl mb-4">üèÜ</div>
                <div class="text-xs uppercase tracking-widest text-[#5865F2] font-bold mb-2">Ofici√°ln√≠ Certifik√°t</div>
                <h2 class="text-2xl font-bold text-white mb-2">VRCHN√ç FACT-CHECKER</h2>
                <div class="text-gray-400 mb-6">Udƒõleno u≈æivateli</div>
                
                <div class="text-4xl font-bold text-white bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent mb-6">
                    Kl√°rka
                </div>
                
                <div class="text-gray-300 mb-8">
                    Za prok√°z√°n√≠ znalosti m√Ωch chyb, omyl≈Ø a v≈°ech inside jokes.<br>
                    <span class="text-sm text-gray-400">(A za tolerov√°n√≠ m√©ho m√≠rn√©ho autismu)</span>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-[#202225] p-3 rounded">
                        <div class="text-xs text-gray-400">Sk√≥re</div>
                        <div class="text-xl font-bold text-white" id="quiz-score">0%</div>
                    </div>
                    <div class="bg-[#202225] p-3 rounded">
                        <div class="text-xs text-gray-400">Datum</div>
                        <div class="text-xl font-bold text-white" id="cert-date"></div>
                    </div>
                </div>
                
                <button onclick="showMainApp()" class="bg-[#5865F2] hover:bg-[#4752c4] text-white font-bold py-3 px-8 rounded-lg transition">
                    <i class="fas fa-door-open mr-2"></i>Vstoupit do Kiscordu
                </button>
            </div>
        </div>
    </div>

    <!-- ========== MAIN APP ========== -->
    <div id="app-interface" class="flex w-full h-full hidden opacity-0 transition-opacity duration-1000">
        
        <!-- SERVER LIST -->
        <div class="bg-[var(--bg-tertiary)] w-[72px] flex flex-col items-center py-3 gap-2 flex-shrink-0 border-r border-[var(--bg-tertiary)]">
            <!-- Home Icon -->
            <div class="w-12 h-12 bg-[var(--bg-primary)] rounded-full hover:rounded-2xl hover:bg-[var(--blurple)] transition-all cursor-pointer flex items-center justify-center text-[var(--text-normal)] hover:text-white mb-2">
                <i class="fab fa-discord text-xl"></i>
            </div>
            <div class="w-8 h-[2px] bg-[var(--bg-primary)] rounded mb-2"></div>
            
            <!-- Our Server Icon -->
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl cursor-pointer flex items-center justify-center overflow-hidden">
                <div class="w-12 h-12 rounded-2xl cursor-pointer flex items-center justify-center overflow-hidden shadow-lg group transition-all duration-200">
                    <img src="Czippel2_vanoce.png" 
                        alt="K&T Server" 
                        class="w-full h-full object-cover">
                </div>
            </div>
        </div>

        <!-- CHANNEL LIST -->
        <div class="bg-[var(--bg-secondary)] w-60 flex flex-col flex-shrink-0 border-r border-[var(--bg-tertiary)]">
            <!-- Server Header -->
            <div class="h-12 border-b border-[var(--bg-tertiary)] flex items-center justify-between px-4 font-bold text-[var(--text-header)] hover:bg-[#34373c] cursor-pointer transition">
                <span class="truncate">üéÅ V√°noƒçn√≠ D√°rek 2025</span>
                <i class="fas fa-chevron-down text-xs"></i>
            </div>

            <!-- Scrollable Channels -->
            <div class="flex-1 overflow-y-auto py-3 custom-scrollbar">
                <!-- Channels are managed by JS -->
                <div id="channels-container"></div>
            </div>

            <!-- User Profile -->
            <div class="h-[52px] bg-[var(--bg-tertiary)] flex items-center px-2 w-full">
    <div class="relative w-8 h-8 mr-2 cursor-pointer group">
        <img src="klarka_profilovka.webp" 
             alt="Kl√°rka" 
             class="w-8 h-8 rounded-full object-cover">
        
        <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-[var(--green)] rounded-full border-2 border-[#292b2f]"></div>
    </div>

    <div class="flex-1 overflow-hidden">
        <div class="text-[var(--text-header)] text-xs font-bold truncate">Kl√°rka</div>
        <div class="text-[var(--interactive-normal)] text-[10px] truncate">#1337 ‚Ä¢ <span id="user-status">Online</span></div>
    </div>
</div>
        </div>

        <!-- MAIN CONTENT AREA -->
        <div class="bg-[var(--bg-primary)] flex-1 flex flex-col min-w-0 relative">
            <!-- Top Bar -->
            <div class="h-12 border-b border-[var(--bg-tertiary)] flex items-center px-4 shadow-sm">
                <i id="channel-icon" class="fas fa-hashtag text-gray-500 text-xl mr-2"></i>
                <span id="channel-name" class="font-bold text-[var(--text-header)] mr-4">uv√≠t√°n√≠</span>
                <span id="channel-desc" class="text-xs text-[var(--interactive-normal)] truncate hidden md:block">Vesel√© V√°noce!</span>
                
                <div class="ml-auto flex items-center gap-4 text-[var(--interactive-normal)]">
                    <!-- Bookmark Counter -->
                    <div id="bookmark-counter" class="hidden bg-[var(--bg-tertiary)] px-2 py-1 rounded text-xs flex items-center gap-2 cursor-pointer hover:text-white" onclick="showWatchlist()" title="Watchlist">
                        <i class="fas fa-bookmark text-[var(--pink)]"></i>
                        <span id="bookmark-count">0</span>
                    </div>
                    
                    <!-- Search -->
                    <div class="bg-[var(--bg-tertiary)] px-2 py-1 rounded text-xs flex items-center gap-2 w-32 md:w-48">
                        <input type="text" placeholder="Hledat..." class="bg-transparent text-white focus:outline-none w-full" id="search-input">
                        <i class="fas fa-search text-xs"></i>
                    </div>
                </div>
            </div>

            <!-- Messages/Content Area -->
            <div id="messages-container" class="flex-1 overflow-y-auto px-4 py-4 custom-scrollbar flex flex-col gap-4 transition-colors duration-300">
                <!-- Content will be injected here -->
            </div>

            <!-- Message Input (disabled for most channels) -->
            <div class="px-4 pb-6 pt-2">
                <div class="bg-[#40444b] rounded-lg px-4 py-3 flex items-center gap-3">
                    <input type="text" id="main-input" placeholder="Tento kan√°l je jen pro ƒçten√≠ (nebo tajn√© p≈ô√≠kazy?)" class="bg-transparent text-[var(--interactive-normal)] flex-1 focus:outline-none placeholder-gray-500">
                </div>
            </div>
        </div>

        <!-- MEMBER LIST -->
        <div class="w-60 bg-[var(--bg-secondary)] hidden lg:flex flex-col p-3 flex-shrink-0 border-l border-[var(--bg-tertiary)]">
            <h3 class="text-xs font-bold text-[#8e9297] uppercase mb-2 px-2">ONLINE ‚Äî 2</h3>
            
            <!-- Me -->
            <div class="flex items-center gap-3 px-2 py-1.5 rounded hover:bg-[var(--bg-primary)] cursor-pointer group">
                <div class="relative">
                    <img src="discord_profilovka.jpg" alt="Jo≈æka" class="w-8 h-8 rounded-full object-cover">
                    <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-[var(--green)] rounded-full border-2 border-[#2f3136]"></div>
                </div>
                <div>
                    <div class="font-bold text-gray-200 text-sm">Jo≈æka</div>
                    <div class="text-xs text-gray-400">Hraje <span class="text-[var(--interactive-normal)]">Tetris</span></div>
                </div>
            </div>

            <!-- Her -->
            <div class="flex items-center gap-3 px-2 py-1.5 rounded hover:bg-[var(--bg-primary)] cursor-pointer group mt-1">
                <div class="relative">
                    <img src="klarka_profilovka.webp" alt="Kl√°rka" class="w-8 h-8 rounded-full object-cover">
                    <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-[var(--green)] rounded-full border-2 border-[#2f3136]"></div>
                </div>
                <div>
                    <div class="font-bold text-gray-200 text-sm">Kl√°rka</div>
                    <div class="text-xs text-gray-400">Fact-Checkuje m√Ωty</div>
                </div>
            </div>

            <!-- Themes -->
            <div class="mt-auto pt-6 border-t border-[var(--bg-tertiary)]">
                <div class="text-xs font-bold text-[#8e9297] uppercase px-2 mb-2">T√©ma</div>
                <div class="flex gap-2 px-2">
                    <button onclick="changeTheme('default')" class="flex-1 bg-[var(--blurple)] hover:opacity-90 text-white p-1 rounded text-[10px] shadow-sm">Discord</button>
                    <button onclick="changeTheme('christmas')" class="flex-1 bg-[#c92a2a] hover:opacity-90 text-white p-1 rounded text-[10px] shadow-sm">V√°noce</button>
                    <button onclick="changeTheme('tetris')" class="flex-1 bg-[#a000f0] hover:opacity-90 text-white p-1 rounded text-[10px] shadow-sm">Tetris</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODALS ========== -->
    
    <!-- Download Modal -->
    <div id="download-modal" class="fixed inset-0 z-50 hidden modal-backdrop items-center justify-center p-4">
        <div class="bg-[#36393f] rounded-xl shadow-2xl w-full max-w-md border border-[#202225] overflow-hidden">
            <div class="p-6">
                <div class="text-5xl text-center mb-4">üß≤</div>
                <h3 class="font-bold text-white text-center text-xl mb-2">Stahov√°n√≠</h3>
                <p class="text-gray-300 text-center mb-6" id="download-message"></p>
                
                <div class="space-y-4">
                    <button onclick="openMagnetLink()" class="w-full bg-[#5865F2] hover:bg-[#4752c4] text-white py-3 rounded-lg font-bold flex items-center justify-center gap-3">
                        <i class="fas fa-magnet"></i>
                        Otev≈ô√≠t v qBittorrent
                    </button>
                    <button onclick="openGoogleDrive()" class="w-full bg-[#3ba55c] hover:bg-[#2d7d46] text-white py-3 rounded-lg font-bold flex items-center justify-center gap-3">
                        <i class="fab fa-google-drive"></i>
                        Google Drive (z√°lo≈æn√≠)
                    </button>
                    <button onclick="closeModal('download-modal')" class="w-full bg-[#4f545c] hover:bg-[#5d6269] text-white py-3 rounded-lg">
                        Zru≈°it
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Watchlist Modal -->
    <div id="watchlist-modal" class="fixed inset-0 z-50 hidden modal-backdrop items-center justify-center p-4">
        <div class="bg-[#36393f] rounded-xl shadow-2xl w-full max-w-2xl border border-[#202225] overflow-hidden max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-[#202225] flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <h3 class="font-bold text-white text-xl flex items-center gap-3">
                        <i class="fas fa-bookmark text-[#eb459e]"></i>
                        Tv≈Øj Watchlist
                    </h3>
                    <p class="text-gray-400 text-sm mt-1 ml-2">Polo≈æky k spoleƒçn√©mu sledov√°n√≠</p>
                </div>
                <button onclick="closeModal('watchlist-modal')" class="text-gray-400 hover:text-white transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="watchlist-items" class="p-6 overflow-y-auto flex-1">
                <!-- Watchlist items will be injected here -->
            </div>
            
            <div class="p-6 border-t border-[#202225] flex justify-between">
                <div class="text-gray-400 text-sm">
                    <span id="watchlist-total">0</span> polo≈æek
                </div>
                <div class="space-x-3">
                    <button onclick="exportWatchlist()" class="bg-[#5865F2] hover:bg-[#4752c4] text-white px-4 py-2 rounded text-sm">
                        <i class="fas fa-share mr-1"></i>Exportovat
                    </button>
                    <button onclick="clearWatchlist()" class="bg-[#4f545c] hover:bg-[#5d6269] text-white px-4 py-2 rounded text-sm">
                        <i class="fas fa-trash mr-1"></i>Vyƒçistit
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confession Terminal (CMD Style) -->
    <div id="confession-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-transparent backdrop-blur-sm">
        <div class="cmd-window w-full max-w-3xl rounded-none border border-[#444] cursor-text" onclick="document.getElementById('hidden-input').focus()">
             <!-- Hidden input to capture keypress on mobile/desktop -->
            <input type="text" id="hidden-input" class="opacity-0 absolute" style="top: -1000px">
            
            <div class="cmd-header">
                <div class="flex items-center gap-2">
                    <i class="fas fa-terminal text-[10px]"></i>
                    <span>Administrator: C:\Windows\System32\cmd.exe</span>
                </div>
                <div class="flex gap-2">
                    <div class="w-3 h-3 bg-gray-400"></div>
                    <div class="w-3 h-3 bg-gray-400"></div>
                    <div class="w-3 h-3 bg-red-500 cursor-pointer" onclick="closeModal('confession-modal')"></div>
                </div>
            </div>
            <div class="cmd-body" id="terminal-body">
                <div id="terminal-output"></div>
                <div class="flex">
                    <span id="prompt-text">C:\Kl√°rka\Heart&gt;</span>
                    <span id="typing-area" class="ml-2"></span>
                    <span id="cmd-cursor" class="cmd-cursor ml-1"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Final Confession UI -->
    <div id="final-confession-modal" class="fixed inset-0 z-50 hidden modal-backdrop items-center justify-center p-4">
        <div class="bg-[#36393f] rounded-xl shadow-2xl w-full max-w-md border border-[#5865F2] overflow-hidden relative animate-fade-in" id="final-modal-box">
            <!-- Close Button -->
            <button onclick="closeModal('final-confession-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
            
            <div class="p-8 text-center" id="final-modal-content">
                <!-- No title as requested -->
                
                <div id="typing-container" class="text-gray-300 mb-8 text-left space-y-4 leading-relaxed min-h-[200px] mt-8">
                    <!-- Text will be typed here -->
                </div>
                
                <div id="confession-buttons" class="space-y-3 hidden">
                    <button onclick="responseYes()" class="w-full bg-gradient-to-r from-[#eb459e] to-[#5865F2] hover:opacity-90 text-white py-4 rounded-lg font-bold text-lg transition shadow-lg">
                        Ano, pojƒème to zkusit <i class="fas fa-heart ml-2"></i>
                    </button>
                    <button onclick="responseNo()" class="w-full bg-[#4f545c] hover:bg-[#5d6269] text-white py-3 rounded-lg transition">
                        Z≈Østa≈àme kamar√°di
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Redirect Prompt Modal -->
    <div id="redirect-modal" class="fixed inset-0 z-[60] hidden modal-backdrop items-center justify-center p-4">
        <div class="bg-[#36393f] rounded-xl shadow-2xl w-full max-w-sm border border-[#202225] p-6 text-center">
            <div class="text-4xl mb-3 text-[#3ba55c]"><i class="fas fa-check-circle"></i></div>
            <h3 class="text-xl font-bold text-white mb-2">N√°vrh zkop√≠rov√°n!</h3>
            <p class="text-gray-300 mb-6 text-sm">Informace o rande byly ulo≈æeny do schr√°nky. M≈Ø≈æe≈° mi je poslat na Discordu (CTRL+V).</p>
            <div class="flex gap-2">
                <a href="https://discord.com/app" target="_blank" class="flex-1 bg-[#5865F2] hover:bg-[#4752c4] text-white py-2 rounded font-bold text-sm">
                    P≈ôej√≠t na Discord
                </a>
                <button onclick="closeModal('redirect-modal')" class="flex-1 bg-[#4f545c] hover:bg-[#5d6269] text-white py-2 rounded font-bold text-sm">
                    Zav≈ô√≠t
                </button>
            </div>
        </div>
    </div>

    <!-- ========== JAVASCRIPT ========== -->
    <script>
        // --- GLOBAL STATE ---
        const state = {
            currentChannel: 'welcome',
            watchlist: JSON.parse(localStorage.getItem('klarka_watchlist')) || [],
            quizAnswers: JSON.parse(localStorage.getItem('klarka_quiz')) || { score: 0, completed: false },
            currentDownload: null,
            terminalIndex: 0
        };

        // --- QUIZ DATA ---
        const quizQuestions = [
            { question: "Sezn√°mili jsme se kv≈Øli ≈°kole.", correct: false, explanation: "Bylo to kv≈Øli Clashku, ale pros√≠m tƒõ, zmƒõ≈à si deck a≈• m√°≈° taky nƒõkdy ≈°anci mƒõ porazit." },
            { question: "Podol√≠ je samostatn√° obec.", correct: false, explanation: "Je to jenom ƒç√°st Kunovic. Smi≈ô se s t√≠m, ƒç√≠m d≈ô√≠v to p≈ôijme≈°, t√≠m l√≠p pro tebe (prostƒõ jsi Kunovjanka)." },
            { question: "≈Ωeny jsou ≈°patn√© ≈ôidiƒçky.", correct: false, explanation: "Jsi m≈Øj osobn√≠ Uber a zvl√°d√°≈° to aj bez svƒõtel a pod vlivem... :-)." },
            { question: "P≈ôi t√°bor√°ku n√°m pes se≈æral ≈ô√≠zek.", correct: false, explanation: "Byl to ≈°pek√°ƒçek. Zlodƒõj, nev√≠m, jestli n√°hodou nebyl ƒçern√Ω, ale v√≠m, ≈æe vypadal jak ≈°pek√°ƒçek." },
            { question: "Nero hr√°l na lyru, zat√≠mco ≈ò√≠m lehl popelem.", correct: false, explanation: "Je to m√Ωtus, jo, vƒõ≈ô√≠m v m√Ωty a legendy, aj d√≠ky tomu byl v√Ωlet do Pole≈°ovic legend√°rn√≠. V√°≈æ√≠m si toho, ≈æe jsi m≈Øj osobn√≠ fact-checker." },
            { question: "Um√≠m poznat v≈°echny hvƒõzdy na obloze.", correct: true, explanation: "Um√≠m je poznat, jenom jim d√°m nov√° kreativn√≠ jm√©na jako ‚Äûvrtuln√≠k‚Äú nebo ‚Äûletadlo‚Äú. Why so Sirius?" },
            { question: "Jsem nejlep≈°√≠ hr√°ƒç Geoguessru na svƒõtƒõ.", correct: true, explanation: "V≈°ude jsem byl, v≈°ude to zn√°m, nikdy jsi mƒõ neporazila, m√°m prostƒõ orientaƒçn√≠ smysl prav√©ho skauta." },
            { question: "Nejlep≈°√≠ vƒõc, co se d√° koupit, je Casio kalkulaƒçka.", correct: true, explanation: "Ale jenom do chv√≠le, ne≈æ pozn√°≈° tu ply≈°ovou s p√≠sk√°tkem." },
            { question: "Popcorn je ide√°ln√≠ snack k filmu.", correct: false, explanation: "Sere se mezi zuby, tak snad budou ty Tetris gum√≠dky ok." },
            { question: "Sezen√≠ u poƒç√≠taƒçe a sprchov√°n√≠ jsou bezpeƒçn√© aktivity.", correct: false, explanation: "M≈Ø≈æeme se zeptat tv√©ho p≈ôisedl√©ho/zlomen√©ho kotn√≠ku." },
             { question: "Br√Ωle jsou nutn√© k tomu, aby ƒçlovƒõk vidƒõl.", correct: false, explanation: "Aj bez br√Ωl√≠ vid√≠≈° moji retardaci/autismus/ADHD a teorie, kter√© nikdo jin√Ω nech√°pe." }
        ];

        // Ensure unique random facts
        const funFacts = [
            "üêô Chobotnice maj√≠ t≈ôi srdce. Dvƒõ pumpuj√≠ krev do ≈æ√°ber a jedno do zbytku tƒõla.",
            "ü¶â Sovy nemohou h√Ωbat oƒçima v d≈Ølc√≠ch, proto mus√≠ ot√°ƒçet celou hlavou (a≈æ o 270¬∞).",
            "üêô Chobotnice m√° modrou krev, proto≈æe obsahuje mƒõƒè m√≠sto ≈æeleza.",
            "ü¶â Sovy sly≈°√≠ ko≈ôist i pod snƒõhem d√≠ky asymetricky um√≠stƒõn√Ωm u≈°√≠m.",
            "üêô Chobotnice jsou mistry √∫nik≈Ø a dok√°≈æou se prot√°hnout jak√Ωmkoliv otvorem vƒõt≈°√≠m ne≈æ jejich zob√°k.",
            "ü¶â Skupinƒõ sov se v angliƒçtinƒõ ≈ô√≠k√° 'parliament' (parlament).",
            "üêô Chobotnice dok√°≈æou mƒõnit barvu a texturu k≈Ø≈æe bƒõhem zlomku sekundy.",
            "ü¶â Nƒõkter√© sovy (jako V√Ωr velk√Ω) lov√≠ i men≈°√≠ sovy.",
            "üêô Chobotnice jsou jedny z nejinteligentnƒõj≈°√≠ch bezobratl√Ωch, pou≈æ√≠vaj√≠ n√°stroje.",
            "ü¶â Sov√≠ pe≈ô√≠ je uzp≈Øsobeno pro naprosto tich√Ω let."
        ];
        let availableFacts = [...funFacts];

        const GLOBAL_DRIVE_LINK = "https://drive.google.com/drive/folders/19KnBcai5wHxwlryX_keLO9zPs8Qvj48l?usp=sharing";

        const library = {
            movies: [
                {id:103,title:"Angry Birds",icon:"üê¶",cat:"Anim√°ky & Poh√°dky",magnet:"magnet:?xt=urn:btih:3cfd78366ccfe2f5ce6d0f7d17f6e6abdc46cabd&dn=Angry.Birds.ve.filmu.2016.1080p.BluRay.CZ.SK.AC3.x264-Mr.MUX&xl=2196742337",gdrive:GLOBAL_DRIVE_LINK},
                {id:116,title:"Shrek",icon:"üßÖ",cat:"Anim√°ky & Poh√°dky",magnet:"magnet:?xt=urn:btih:ab2acd192c6bb60d5445c3216cacf72f609e21e1&dn=Shrek.Complete.Collection.1080p.CZ.EN.MixeD.x265-R.i.H&xl=24813754031",gdrive:GLOBAL_DRIVE_LINK},
                {id:128,title:"Za plotem",icon:"ü¶ù",cat:"Anim√°ky & Poh√°dky",magnet:"magnet:?xt=urn:btih:a4078b0b3e7b1e12f51855ca313eac8ea1231b2c&dn=Za%20plotem%20%28Over%20the%20Hedge%29.2006.CZ.WebRip.1080p.10b.HEVC.C4U.mkv&xl=1903318064&tr=file%3A%2F%2F%2FD%3A%2Ffilmy%2FDedictvi%20aneb%20kurvahosigutntag%20%281992%29%20%5BCZ%5D%5BBDRip%5D%5B1080p%5D%5BHEVC%5D.mkv",gdrive:GLOBAL_DRIVE_LINK},
                {id:127,title:"√ö≈æas≈à√°kovi",icon:"ü¶∏",cat:"Anim√°ky & Poh√°dky",magnet:"magnet:?xt=urn:btih:2df5d449cf518fe2b9c1b1314b7735194c3b45e6&dn=%C3%9A%C5%BEas%C5%88%C3%A1kovi.avi&xl=1793605632&tr=file%3A%2F%2F%2FD%3A%2Ffilmy%2FDedictvi%20aneb%20kurvahosigutntag%20%281992%29%20%5BCZ%5D%5BBDRip%5D%5B1080p%5D%5BHEVC%5D.mkv",gdrive:GLOBAL_DRIVE_LINK},
                {id:113,title:"Rango",icon:"ü¶é",cat:"Anim√°ky & Poh√°dky",magnet:"magnet:?xt=urn:btih:bf1e9444f0ec40cae01e818de909e0456eedb541&dn=Rango.2011.Blu-ray.1080p.Extended.Cut.x264-CZ.SK.EN&xl=7072763782",gdrive:GLOBAL_DRIVE_LINK},
                {id:5,title:"Klaus",icon:"üéÖ",cat:"Anim√°ky & Poh√°dky",magnet:"magnet:?xt=urn:btih:1de24ef937f587ab64e284025582c27cf41246d9&dn=Klaus.2019.HDR.2160p.WEBRip.x265.CZ-iNTENSO&xl=5919259882",gdrive:GLOBAL_DRIVE_LINK},
                {id:101,title:"21 Jump Street",icon:"üëÆ",cat:"Komedie",magnet:"magnet:?xt=urn:btih:a7420cc60bde351b57d2f8c031d74a3177b05f65&dn=21%2C22%20Jump%20Street%202012%2C2014%201080p%20%28Multi%29%20WEB-DL%20HEVC%20x265%205.1%20BONE&xl=4540117518",gdrive:GLOBAL_DRIVE_LINK},
                {id:102,title:"22 Jump Street",icon:"üöî",cat:"Komedie",magnet:"magnet:?xt=urn:btih:a7420cc60bde351b57d2f8c031d74a3177b05f65&dn=21%2C22%20Jump%20Street%202012%2C2014%201080p%20%28Multi%29%20WEB-DL%20HEVC%20x265%205.1%20BONE&xl=4540117518",gdrive:GLOBAL_DRIVE_LINK},
                {id:122,title:"Borat",icon:"üëç",cat:"Komedie",magnet:"magnet:?xt=urn:btih:4a80c302f3443fb48374ee2fd74a0fc7b637ffe2&dn=Borat%20%282006%29%20FHD%20cz%20en.mkv&xl=2050976063",gdrive:"https://drive.google.com/file/d/1yTGPSkYW4KskCqjXb9PlSeNYSsuoOqoG/view?usp=sharing"},
                {id:118,title:"The Hangover",icon:"üòµ",cat:"Komedie",magnet:"magnet:?xt=urn:btih:bf4512d9861586190359e6c4552e3f9427a930e3&dn=The%20Hangover%20Trilogy%202009%2C2011%2C2013%2C%201080p%20BluRay%20HEVC%20x265%205.1%20BONE&xl=4674467377",gdrive:GLOBAL_DRIVE_LINK},
                {id:124,title:"Dr≈æ hubu!",icon:"ü§ê",cat:"Komedie",magnet:"magnet:?xt=urn:btih:df7c4d2dcd42597e96068bf8d366dd452e9489f8&dn=Dr%C5%BE%20hubu%21%20%282003%29%20FHD%20cz%20fr.mkv&xl=2143250882&tr=file%3A%2F%2F%2FD%3A%2Ffilmy%2FDedictvi%20aneb%20kurvahosigutntag%20%281992%29%20%5BCZ%5D%5BBDRip%5D%5B1080p%5D%5BHEVC%5D.mkv",gdrive:GLOBAL_DRIVE_LINK},
                {id:123,title:"Dƒõdictv√≠",icon:"üöú",cat:"Komedie",magnet:"magnet:?xt=urn:btih:ca95eb295f94086eecc166c6f0c245db7c4882eb&dn=Dedictvi%20aneb%20kurvahosigutntag%20%281992%29%20%5BCZ%5D%5BBDRip%5D%5B1080p%5D%5BHEVC%5D.mkv&xl=2867771371&tr=file%3A%2F%2F%2FD%3A%2Ffilmy%2FDedictvi%20aneb%20kurvahosigutntag%20%281992%29%20%5BCZ%5D%5BBDRip%5D%5B1080p%5D%5BHEVC%5D.mkv",gdrive:GLOBAL_DRIVE_LINK},
                {id:115,title:"Scary Movie 1-5",icon:"üëª",cat:"Komedie",magnet:"magnet:?xt=urn:btih:d9f7d0a6308a77b53bc1f04ced920c0c614e1cb7&dn=Scary%20Movie%201-5%20Collection%202000-2013%201080p%20BluRay%20HEVC%20x265%205.1%20BONE&xl=6644413780",gdrive:GLOBAL_DRIVE_LINK},
                {id:2,title:"The Dark Knight",icon:"ü¶á",cat:"Akƒçn√≠ & Sci-Fi",magnet:"magnet:?xt=urn:btih:a4ea09adf3c9a51fe719b0358aa37cbe7545f63f&dn=The.Dark.Knight.2008.1080p.BluRay.DDP5.1.x265.10bit-GalaxyRG265%5BTGx%5D&xl=4315567522",gdrive:GLOBAL_DRIVE_LINK},
                {id:7,title:"The Matrix",icon:"üíä",cat:"Akƒçn√≠ & Sci-Fi",magnet:"magnet:?xt=urn:btih:db63243fdcc154dfd1034d9ae6f939be563f7973&dn=The%20Matrix%20%281999%29%202160p%20H265%2010%20bit%20DV%20HDR10%2B%20ita%20eg%20AC3%205.1%20sub%20ita%20eng%20Licdom.mkv&xl=4291914323&tr=file%3A%2F%2F%2FD%3A%2Ffilmy%2FDedictvi%20aneb%20kurvahosigutntag%20%281992%29%20%5BCZ%5D%5BBDRip%5D%5B1080p%5D%5BHEVC%5D.mkv",gdrive:GLOBAL_DRIVE_LINK},
                {id:105,title:"Deadpool",icon:"‚öîÔ∏è",cat:"Akƒçn√≠ & Sci-Fi",magnet:"magnet:?xt=urn:btih:19ec5948aa22e430ceef97c559a685d81018fc87&dn=Deadpool.2016.1080p.BluRay.DDP5.1.x265.10bit-GalaxyRG265%5BTGx%5D&xl=2749846096",gdrive:GLOBAL_DRIVE_LINK},
                {id:110,title:"Logan",icon:"üê∫",cat:"Akƒçn√≠ & Sci-Fi",magnet:"magnet:?xt=urn:btih:0480637222dd5a1a2e7a199c56cce0b00c35b51c&dn=Logan%20%282017%29%20%5B1080p%5D%20%5BYTS.AG%5D&xl=2248685741",gdrive:GLOBAL_DRIVE_LINK},
                {id:107,title:"Guardians of the Galaxy",icon:"üåå",cat:"Akƒçn√≠ & Sci-Fi",magnet:"magnet:?xt=urn:btih:2479bc7abfbca9921eb61318e567ad2c40971c95&dn=Guardians.of.the.Galaxy.2014.IMAX.1080p.BluRay.DDP5.1.x265.10bit-GalaxyRG265%5BTGx%5D&xl=2737487733",gdrive:GLOBAL_DRIVE_LINK},
                {id:114,title:"Ready Player One",icon:"üï∂Ô∏è",cat:"Akƒçn√≠ & Sci-Fi",magnet:"magnet:?xt=urn:btih:0b2a8eac63a94cedf31118400f3f4bcb08b72d1a&dn=Ready%20Player%20One%20%282018%29%20%5BBluRay%5D%20%5B1080p%5D%20%5BYTS.AM%5D&xl=2415181864",gdrive:GLOBAL_DRIVE_LINK},
                {id:121,title:"Alien",icon:"üëΩ",cat:"Akƒçn√≠ & Sci-Fi",magnet:"magnet:?xt=urn:btih:dffbfb159af59bd3eb8cf720b8fa99b6ac72ba78&dn=Alien%201979%20DC%20REMASTERED%201080p%20BluRay%20HEVC%20x265%205.1%20BONE.mkv&xl=2075161124",gdrive:GLOBAL_DRIVE_LINK},
                {id:111,title:"Mad Max: Fury Road",icon:"üî•",cat:"Akƒçn√≠ & Sci-Fi",magnet:"magnet:?xt=urn:btih:dbac9177cdbb06dfcb0ced506170b47b6f5e9796&dn=Mad.Max.Fury.Road.2015.1080p.BluRay.DDP5.1.x265.10bit-GalaxyRG265%5BTGx%5D&xl=3959350923",gdrive:GLOBAL_DRIVE_LINK},
                {id:119,title:"LOTR Trilogie",icon:"üíç",cat:"Akƒçn√≠ & Sci-Fi",magnet:"magnet:?xt=urn:btih:c8216c593a3bc4e660b9b12d49bb91b5857ae7bc&dn=The.Lord.Of.The.Rings.Trilogy.Extended.Remastered.1080p.BluRay.x265%20-88&xl=12166339629",gdrive:GLOBAL_DRIVE_LINK},
                {id:1,title:"The Shawshank Redemption",icon:"üîì",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:e79a5b4ac27a9e66adf91689a98deb0d3ba7674b&dn=The.Shawshank.Redemption.1994.1080p.BluRay.x265.AAC.5.1%20-88&xl=2384290903",gdrive:GLOBAL_DRIVE_LINK},
                {id:4,title:"Pulp Fiction",icon:"üçî",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:2516dd0343be41e7292b40441fcd84646c156d96&dn=Pulp%20Fiction%20Historky%20z%20podsveti%201994&xl=3066884151",gdrive:GLOBAL_DRIVE_LINK},
                {id:6,title:"Fight Club",icon:"üëä",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:70981326246aaea630c288c2429e683aa2690603&dn=Fight.Club.1999.REMASTERED.1080p.BluRay.DDP5.1.x265.10bit-GalaxyRG265%5BTGx%5D&xl=4301531029",gdrive:GLOBAL_DRIVE_LINK},
                {id:8,title:"Whiplash",icon:"ü•Å",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:419dc46785809c0a9760be3046fb8cb880cf8493&dn=Whiplash%20%282014%29%20%2B%20Extras%20%281080p%20BluRay%20x265%20HEVC%2010bit%20AAC%207.1%20afm72%29&xl=4633276114",gdrive:GLOBAL_DRIVE_LINK},
                {id:106,title:"Donnie Darko",icon:"üê∞",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:8ecc1f141602919fc05d36eb88e6f1dca295019a&dn=Donnie.Darko.2001.REMASTERED.DC.1080p.BluRay.H264.AAC%20%5B88%5D&xl=2740960879",gdrive:GLOBAL_DRIVE_LINK},
                {id:112,title:"Prisoners",icon:"üî¶",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:e778030429d87438eb4f4a3b8197e5996c79f0e7&dn=Prisoners.2013.1080p.BluRay.DDP5.1.x265.10bit-GalaxyRG265%5BTGx%5D&xl=2681606834",gdrive:GLOBAL_DRIVE_LINK},
                {id:125,title:"Seven",icon:"üì¶",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:61d09d1a63b8a630a8825307f87a9c14b268e382&dn=Seven%20-%20Se7en%20%281995%29%202160p%20H265%2010%20bit%20DV%20ita%20eng%20AC3%205.1%20sub%20ita%20eng%20NUita%20NUeng-Licdom.mkv&xl=3885400010&tr=file%3A%2F%2F%2FD%3A%2Ffilmy%2FDedictvi%20aneb%20kurvahosigutntag%20%281992%29%20%5BCZ%5D%5BBDRip%5D%5B1080p%5D%5BHEVC%5D.mkv",gdrive:GLOBAL_DRIVE_LINK},
                {id:126,title:"The Social Network",icon:"üëç",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:5c918fd1b8e6c2316463617d3727a2cfe1b24d4e&dn=The.Social.Network.2010.iTA.ENG.AC3.SUB.iTA.ENG.BluRay.HEVC.1080p.x265.jeddak-MIRCrew.mkv&xl=2946953369&tr=file%3A%2F%2F%2FD%3A%2Ffilmy%2FDedictvi%20aneb%20kurvahosigutntag%20%281992%29%20%5BCZ%5D%5BBDRip%5D%5B1080p%5D%5BHEVC%5D.mkv",gdrive:GLOBAL_DRIVE_LINK},
                {id:109,title:"Le Mans 66",icon:"üèéÔ∏è",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:84e8d7aba68140f12a4789ced23e0b7a1b278aa6&dn=Le%20Mans%2066%20Ford%20v%20Ferrari%20BluRay%201080xH264%20Ita%20Eng%20AC3%205.1%20Sub%20Ita%20Eng&xl=3828506737",gdrive:GLOBAL_DRIVE_LINK},
                {id:117,title:"The Gentlemen",icon:"ü•É",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:8896eea0fcf5ab67b547f980a53141217cded510&dn=The%20Gentlemen%20%282019%29%20%281080p%20BluRay%20x265%20HEVC%2010bit%20AAC%207.1%20Vyndros%29&xl=4387443401",gdrive:GLOBAL_DRIVE_LINK},
                {id:120,title:"The Thing",icon:"‚ùÑÔ∏è",cat:"Drama & Thriller",magnet:"magnet:?xt=urn:btih:4823e1956eba859311db0621ca9ea7d5bb4a66ca&dn=The.Thing.1982.REMASTERED.1080p.BluRay.x264.AAC5.0-ShAaNiG&xl=2142451662",gdrive:GLOBAL_DRIVE_LINK}
            ],
            series: [
                {id:9,title:"Breaking Bad",icon:"üß™",magnet:"magnet:?xt=urn:btih:7118a27453275949493ab3d77b709456404e0ef6&dn=Breaking%20Bad%20%282008%29%20Season%201-5%20S01-S05%20%281080p%20BluRay%20x265%20HEVC%2010bit%20AAC%205.1%20Silence%29&xl=150389060754",gdrive:GLOBAL_DRIVE_LINK},
                {id:11,title:"Mr. Robot",icon:"üíª",magnet:"magnet:?xt=urn:btih:704122faa6db389c8e2eff2dbd12e5aa8712fe63&dn=Mr.Robot.COMPLETE.1080p.BluRay.AV1.DDP.5.1-dAV1nci&xl=30529111722",gdrive:GLOBAL_DRIVE_LINK},
                {id:12,title:"True Detective S1",icon:"üïµÔ∏è",magnet:"magnet:?xt=urn:btih:6f6fe19e361b14dc74c4a1dae8e51e802ef65ae7&dn=True%20Detective%20Season%201%20%20%281080p%20BD%20x265%2010bit%20FS84%20Joy%29&xl=5543662591",gdrive:GLOBAL_DRIVE_LINK}
            ],
            games: [
                {id:13,title:"Tetris Effect",icon:"üß©",magnet:"magnet:?xt=urn:btih:e38087a21f8acab8e6f7120cd0622af10eaeb280&dn=Tetris.Effect.Connected.v2.0.2.rar&xl=3216489007",gdrive:GLOBAL_DRIVE_LINK},
                {id:14,title:"Hades",icon:"‚ö°",magnet:"magnet:?xt=urn:btih:70947d6b874a01385511d50166cb2d23855facb1&dn=Hades.v1.38100.zip&xl=11582699763",gdrive:GLOBAL_DRIVE_LINK},
                {id:15,title:"Dead Cells",icon:"üíÄ",magnet:"magnet:?xt=urn:btih:3fed513b1d4172969a0239c0b0730e5c5a18894b&dn=Dead%20Cells%20%5BFitGirl%20Repack%5D&xl=2472856355",gdrive:GLOBAL_DRIVE_LINK},
                {id:301,title:"Balatro",icon:"üÉè",magnet:"magnet:?xt=urn:btih:8823764e16d978e6e0f9b46bf8a66416dad2f505&dn=Balatro.v1.0.1N&xl=66744928&tr=file%3A%2F%2F%2FD%3A%2Ffilmy%2FDedictvi%20aneb%20kurvahosigutntag%20%281992%29%20%5BCZ%5D%5BBDRip%5D%5B1080p%5D%5BHEVC%5D.mkv",gdrive:GLOBAL_DRIVE_LINK},
                {id:302,title:"Brotato",icon:"ü•î",magnet:"magnet:?xt=urn:btih:364d8768cc4628a3ad59a44644c34f324624fbea&dn=Brotato.v1.1.13.0&xl=308392977",gdrive:GLOBAL_DRIVE_LINK},
                {id:303,title:"Kingdom: Two Crowns",icon:"üëë",magnet:"magnet:?xt=urn:btih:05c33ad86589f64f0b26b51902e2edde80603f29&dn=Kingdom.Two.Crowns.v2.3&xl=4656710442",gdrive:GLOBAL_DRIVE_LINK},
                {id:304,title:"Mafia II: DE",icon:"üî´",magnet:"magnet:?xt=urn:btih:4ed851ea6c87126480d2049f7b4d47fbb2d9e28f&dn=Mafia%20II%20-%20Definitive%20Edition%20%5BFitGirl%20Repack%5D&xl=13314267858",gdrive:GLOBAL_DRIVE_LINK},
                {id:305,title:"Papa's Freezeria",icon:"üç¶",magnet:"magnet:?xt=urn:btih:9c56c4604c305af0f51d908dc7930b7da48f8e77&dn=Papas.Freezeria.Deluxe&xl=63577281",gdrive:GLOBAL_DRIVE_LINK},
                {id:306,title:"Stackflow",icon:"üíª",magnet:"magnet:?xt=urn:btih:16e4c04d877d0fc94fa1d0fee3763d5fb3fbc0be&dn=Stackflow.v0.9&xl=129021781",gdrive:GLOBAL_DRIVE_LINK},
                {id:307,title:"Enter the Gungeon",icon:"üî´",magnet:"magnet:?xt=urn:btih:d83d3e3e9f40a1d0ae2b5aacf2360fb2ddcb7abb&dn=Enter.the.Gungeon.v2.1.3.zip&xl=670706499",gdrive:GLOBAL_DRIVE_LINK},
                {id:308,title:"Hades II",icon:"üåô",magnet:"magnet:?xt=urn:btih:3fb5b6737355f1d93e77969d7638fee90806b9d8&dn=Hades.II.v1.133066.rar&xl=9079366716",gdrive:GLOBAL_DRIVE_LINK},
                {id:309,title:"Jump King",icon:"üëë",magnet:"magnet:?xt=urn:btih:ee670e09061d5e5694ea356a8029a280766739e5&dn=Jump.King.v1.06.rar&xl=1313998599",gdrive:GLOBAL_DRIVE_LINK}
            ]
        };

        // --- CORE FUNCTIONS ---
        function getUniqueFunFact() {
            if (availableFacts.length === 0) availableFacts = [...funFacts];
            return availableFacts.splice(Math.floor(Math.random() * availableFacts.length), 1)[0];
        }

        function verifyLocation() {
            const btn = document.getElementById('verify-btn');
            const status = document.getElementById('verify-status');
            const text = document.getElementById('verify-text');
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');
            text.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Ovƒõ≈ôov√°n√≠...';
            status.classList.remove('hidden');
            const steps = ["üì° P≈ôipojov√°n√≠ k satelitu...", "üìç Triangulace pozice...", "‚ùå Podol√≠... 404 Not Found", "‚úÖ Kunovice... NALEZENO"];
            let i = 0;
            const interval = setInterval(() => {
                if (i < steps.length) {
                    const div = document.createElement('div');
                    div.className = i === 2 ? 'text-red-400' : (i === 3 ? 'text-green-400 font-bold' : 'text-gray-400');
                    div.innerHTML = steps[i];
                    status.appendChild(div);
                    i++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('login-screen').style.display = 'none';
                        showQuiz();
                    }, 1000);
                }
            }, 800);
        }

        function changeTheme(theme) {
            const root = document.documentElement;
            // Clear inline styles first (font-family, font-size from Tetris)
            document.body.style.fontFamily = '';
            document.body.style.fontSize = '';
            
            if (theme === 'christmas') { 
                root.style.setProperty('--bg-tertiary', '#420d0d'); 
                root.style.setProperty('--bg-secondary', '#5c1414'); 
                root.style.setProperty('--bg-primary', '#240a0a'); 
                root.style.setProperty('--blurple', '#c92a2a'); // Red
                root.style.setProperty('--green', '#ffd700'); // Gold
                root.style.setProperty('--text-header', '#ffffff');
                root.style.setProperty('--interactive-active', '#ffffff');
                root.style.setProperty('--interactive-normal', '#e8e8e8'); // Lighter text
                root.style.setProperty('--text-normal', '#f0f0f0');
            } 
            else if (theme === 'tetris') {
                root.style.setProperty('--bg-tertiary', '#0d0e15');
                root.style.setProperty('--bg-secondary', '#151620');
                root.style.setProperty('--bg-primary', '#1c1d29');
                root.style.setProperty('--blurple', '#00e5ff'); 
                root.style.setProperty('--green', '#69f0ae'); 
                root.style.setProperty('--red', '#ff5252'); 
                root.style.setProperty('--yellow', '#ffd740'); 
                root.style.setProperty('--pink', '#e040fb'); 
                root.style.setProperty('--text-normal', '#33ff00');
                root.style.setProperty('--interactive-normal', '#33ff00');
                document.body.style.fontFamily = "'Press Start 2P', cursive"; 
                document.body.style.fontSize = "0.8rem";
            }
            else { // default
                root.style.setProperty('--bg-tertiary', '#202225'); root.style.setProperty('--bg-secondary', '#2f3136'); root.style.setProperty('--bg-primary', '#36393f'); 
                root.style.setProperty('--blurple', '#5865F2');
                root.style.setProperty('--green', '#3ba55c');
                root.style.setProperty('--red', '#ed4245');
                root.style.setProperty('--yellow', '#faa61a');
                root.style.setProperty('--pink', '#eb459e');
                root.style.setProperty('--text-normal', '#dcddde');
                root.style.setProperty('--interactive-normal', '#b9bbbe');
            }
            showNotification(`T√©ma zmƒõnƒõno: ${theme}`, 'success');
        }

        // --- QUIZ ---
        function showQuiz() {
            document.getElementById('quiz-screen').style.display = 'flex';
            loadQuizQuestion(0);
        }
        function loadQuizQuestion(index) {
            const container = document.getElementById('quiz-container');
            const progress = ((index) / quizQuestions.length) * 100;
            document.getElementById('quiz-progress').style.width = `${progress}%`;
            document.getElementById('quiz-step-text').innerText = `${index + 1}/${quizQuestions.length}`;
            if (index >= quizQuestions.length) { finishQuiz(); return; }
            const q = quizQuestions[index];
            container.innerHTML = `<div class="mb-10 text-center"><h3 class="text-white font-extrabold text-2xl leading-relaxed">${q.question}</h3></div><div id="quiz-options" class="flex flex-col gap-4"><button onclick="answerQuiz(${index}, true)" class="w-full bg-[#2f3136] hover:bg-[#3ba55c] text-left px-4 py-4 rounded border border-[#202225] hover:border-[#3ba55c] transition flex items-center group"><div class="w-6 h-6 rounded-full border-2 border-gray-500 group-hover:border-white mr-3 flex items-center justify-center"></div><span class="text-gray-300 group-hover:text-white font-medium text-lg">FAKT</span></button><button onclick="answerQuiz(${index}, false)" class="w-full bg-[#2f3136] hover:bg-[#ed4245] text-left px-4 py-4 rounded border border-[#202225] hover:border-[#ed4245] transition flex items-center group"><div class="w-6 h-6 rounded-full border-2 border-gray-500 group-hover:border-white mr-3 flex items-center justify-center"></div><span class="text-gray-300 group-hover:text-white font-medium text-lg">M√ùTUS</span></button></div><div id="quiz-result-feedback" class="hidden mt-4 pt-4 border-t border-[#36393f]"></div>`;
            document.getElementById('fun-fact-container').style.display = 'block';
            document.getElementById('fun-fact-text').innerText = getUniqueFunFact();
        }
        function answerQuiz(index, answer) {
            const q = quizQuestions[index];
            const correct = (answer === q.correct);
            if (!state.quizAnswers.completed && correct) state.quizAnswers.score += 10;
            document.getElementById('quiz-options').style.display = 'none';
            const feedback = document.getElementById('quiz-result-feedback');
            feedback.innerHTML = `
                <div class="mb-6 p-4 bg-[#202225] rounded-lg border-l-4 ${correct ? 'border-green-500' : 'border-red-500'}">
                    <h4 class="${correct?'text-green-400':'text-red-400'} font-bold text-xl mb-2 flex items-center">
                        <i class="fas ${correct?'fa-check-circle':'fa-times-circle'} mr-2"></i>
                        ${correct?'Spr√°vnƒõ!':'Ups!'}
                    </h4>
                    <p class="text-white text-lg leading-relaxed mt-2">${q.explanation}</p>
                </div>
                <button onclick="loadQuizQuestion(${index + 1})" class="w-full bg-[#5865F2] hover:bg-[#4752c4] text-white py-4 rounded-lg font-bold text-xl shadow-md transition transform hover:scale-[1.02]">
                    ${index + 1 < quizQuestions.length ? 'Dal≈°√≠ ot√°zka ‚ûú' : 'Dokonƒçit üéâ'}
                </button>
            `;
            feedback.classList.remove('hidden');
        }
        function finishQuiz() {
            state.quizAnswers.completed = true;
            localStorage.setItem('klarka_quiz', JSON.stringify(state.quizAnswers));
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('quiz-score').textContent = `${state.quizAnswers.score}%`;
            document.getElementById('cert-date').textContent = new Date().toLocaleDateString('cs-CZ');
            document.getElementById('certificate-screen').style.display = 'flex';
        }

        // --- APP NAVIGATION ---
        function showMainApp() {
            document.getElementById('certificate-screen').style.display = 'none';
            const app = document.getElementById('app-interface');
            app.classList.remove('hidden');
            setTimeout(() => app.classList.remove('opacity-0'), 10);
            renderChannels();
            switchChannel('welcome');
            updateBookmarkCounter();
        }
        function renderChannels() {
            const container = document.getElementById('channels-container');
            container.innerHTML = `
                <div class="px-2 mb-4"><div class="flex justify-between px-2 text-xs font-bold text-[var(--interactive-normal)] uppercase mb-1">Informace</div><div onclick="switchChannel('welcome')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-door-open text-gray-500"></i> uv√≠t√°n√≠</div><div onclick="switchChannel('timeline')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-history text-gray-500"></i> timeline</div></div>
                <div class="px-2 mb-4"><div class="flex justify-between px-2 text-xs font-bold text-[var(--interactive-normal)] uppercase mb-1">Knihovna</div><div onclick="switchChannel('manual')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-book text-[var(--green)]"></i> n√°vod</div><div onclick="switchChannel('movies')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-film text-[var(--yellow)]"></i> filmy</div><div onclick="switchChannel('series')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-tv text-[#5865F2]"></i> seri√°ly</div><div onclick="switchChannel('games')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-gamepad text-[var(--green)]"></i> hry</div><div onclick="showWatchlist()" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-[var(--pink)] hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-bookmark text-[var(--pink)]"></i> tv≈Øj-watchlist</div></div>
                <div class="px-2 mb-4"><div class="flex justify-between px-2 text-xs font-bold text-[var(--interactive-normal)] uppercase mb-1">D≈Øle≈æit√©</div><div onclick="switchChannel('upgrade')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-[var(--yellow)] hover:bg-[#faa61a] hover:text-black flex items-center gap-2 cursor-pointer pulse-glow"><i class="fas fa-file-alt text-[var(--yellow)]"></i> README.md</div></div>
            `;
        }
        function switchChannel(channel) {
            document.querySelectorAll('.channel-item').forEach(el => el.classList.remove('bg-[#393c43]', 'text-white'));
            const clicked = Array.from(document.querySelectorAll('.channel-item')).find(el => el.getAttribute('onclick').includes(channel));
            if(clicked) clicked.classList.add('bg-[#393c43]', 'text-white');
            state.currentChannel = channel;
            
            const titles = {'welcome':'uv√≠t√°n√≠','manual':'n√°vod','timeline':'timeline','movies':'filmy','series':'seri√°ly','games':'hry','upgrade':'README.md'};
            const icons = {'welcome':'fa-door-open','manual':'fa-book','timeline':'fa-history','movies':'fa-film','series':'fa-tv','games':'fa-gamepad','upgrade':'fa-file-alt'};
            document.getElementById('channel-name').textContent = titles[channel];
            document.getElementById('channel-icon').className = `fas ${icons[channel]} text-gray-500 text-xl mr-2`;
            document.getElementById('user-status').textContent = channel === 'upgrade' ? 'P≈ôem√Ω≈°l√≠ o upgradu' : 'Online';
            
            const container = document.getElementById('messages-container');
            container.innerHTML = '';
            
            if(channel === 'welcome') renderWelcome();
            else if (channel === 'manual') renderManual();
            else if (channel === 'timeline') renderTimeline();
            else if (['movies','series','games'].includes(channel)) renderLibrary(channel);
            else if (channel === 'upgrade') {
                container.innerHTML = `<div class="flex gap-4 items-start"><img src="discord_profilovka.jpg" 
                 alt="Jo≈æka" 
                 class="w-10 h-10 rounded-full object-cover mt-1 shadow-md"><div class="flex-1"><div class="flex items-baseline gap-2"><span class="font-bold text-[var(--text-header)]">Jo≈æka</span></div><div onclick="startConfession()" class="mt-4 bg-[#2f3136] border border-[#292b2f] rounded p-3 flex items-center gap-3 w-full max-w-sm cursor-pointer hover:bg-[#36393f] transition group"><div class="file-icon-wrapper w-10 h-10 flex items-center justify-center text-4xl text-[#5865F2]"><i class="fas fa-file-code"></i></div><div class="flex-1 min-w-0"><div class="text-[#5865F2] font-medium truncate group-hover:underline text-sm">system_patch_v2.0.exe</div><div class="text-xs text-[#b9bbbe]">1.2 MB ‚Ä¢ Executable</div></div><div class="text-[#b9bbbe] hover:text-white transition text-lg"><i class="fas fa-download"></i></div></div></div></div>`;
            }
            // Add scroll to top logic for timeline as well
            if (['movies', 'series', 'games', 'manual', 'timeline'].includes(channel)) {
                container.scrollTop = 0;
            } else {
                container.scrollTop = container.scrollHeight;
            }
        }

        function renderWelcome() {
            const container = document.getElementById('messages-container');
            container.innerHTML = `
                <div class="flex gap-4 items-start">
                    <div class="w-10 h-10 rounded-full bg-[#5865F2] flex items-center justify-center text-white text-sm font-bold mt-1">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-baseline gap-2">
                            <span class="font-bold text-[var(--text-header)]">System Bot</span>
                            <span class="text-xs text-[var(--interactive-normal)]">Dnes v 22:15</span>
                        </div>
                        <div class="text-[var(--text-normal)] bg-[#2f3136] p-4 rounded-lg mt-2 shadow-sm">
                            <p class="font-bold text-[var(--text-header)] mb-2">V√≠tej na serveru Kiscord, Kl√°rko! üéÑ</p>
                            <p>Tv≈Øj status Vrchn√≠ho Fact-Checkera byl √∫spƒõ≈°nƒõ ovƒõ≈ôen. Abys dokonƒçila dne≈°n√≠ misi, postupuj podle tohoto protokolu:</p>
                            <ul class="list-none pl-0 mt-3 space-y-2 text-sm">
                                <li><i class="fas fa-folder-open text-[var(--yellow)] mr-2"></i> <strong>#knihovna</strong> ‚Äì Projdi si mnou doporuƒçen√© filmy, seri√°ly a hry, rovnou je m≈Ø≈æe≈° stahovat.</li>
                                <li><i class="fas fa-hourglass-half text-[var(--blurple)] mr-2"></i> <strong>#timeline</strong> ‚Äì Synchronizuj si na≈°e spoleƒçn√© vzpom√≠nky a m√Ωty.</li>
                                <li><i class="fas fa-scroll text-[var(--pink)] mr-2"></i> <strong>#README.md</strong> ‚Äì Fin√°ln√≠ syst√©mov√Ω log (otev≈ô√≠t a≈æ po splnƒõn√≠ bod≈Ø 1 a 2).</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4 items-start mt-6">
                    <img src="discord_profilovka.jpg" 
                        alt="Jo≈æka" 
                        class="w-10 h-10 rounded-full object-cover mt-1 shadow-md">
                    <div class="flex-1">
                        <div class="flex items-baseline gap-2">
                            <span class="font-bold text-[var(--text-header)] hover:underline cursor-pointer">Jo≈æka</span>
                            <span class="text-xs text-[var(--interactive-normal)]">Pr√°vƒõ teƒè</span>
                        </div>
                        <div class="text-[var(--text-normal)] mt-1">
                            <p>ƒåus! Snad se ti tento zp≈Øsob p≈ôed√°n√≠ d√°rku l√≠b√≠ üéÖ.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderManual() {
            const container = document.getElementById('messages-container');
            container.innerHTML = `
                <div class="flex gap-4 items-start"><img src="discord_profilovka.jpg" 
                 alt="Jo≈æka" 
                 class="w-10 h-10 rounded-full object-cover mt-1 shadow-md"><div class="flex-1"><div class="flex items-baseline gap-2"><span class="font-bold text-[var(--text-header)]">Jo≈æka</span><span class="text-xs text-[var(--interactive-normal)]">Pinned</span></div><div class="bg-gradient-to-br from-[#2f3136] to-[#202225] border-l-4 border-[#faa61a] p-4 rounded-r-lg mt-3"><h3 class="font-bold text-white text-lg mb-3 flex items-center gap-2"><i class="fas fa-graduation-cap text-[#faa61a]"></i> N√°vod na stahov√°n√≠</h3><div class="space-y-4"><div class="flex gap-3"><div class="w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center text-white flex-shrink-0">1</div><div><p class="font-bold text-white">Instalace qBittorrent</p><p class="text-[var(--text-normal)] text-sm">St√°hni si z <a href="https://www.qbittorrent.org/download.php" target="_blank" class="text-[#5865F2] hover:underline font-bold">qbittorrent.org/download</a>. Neboj, nen√≠ to virus.</p></div></div><div class="flex gap-3"><div class="w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center text-white flex-shrink-0">2</div><div><p class="font-bold text-white">Magnet Link üß≤</p><p class="text-[var(--text-normal)] text-sm">V knihovnƒõ klikni na ikonu stahov√°n√≠ u polo≈æky. Otev≈ôe se ti to p≈ô√≠mo v klientovi.</p></div></div><div class="flex gap-3"><div class="w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center text-white flex-shrink-0">3</div><div><p class="font-bold text-white">HDMI kabel (ten 5m)</p><p class="text-[var(--text-normal)] text-sm">P≈ôipoj notebook k TV, zm√°ƒçkni <code class="bg-black px-1 rounded text-white">Win + P</code> a vyber "Duplicate" nebo "Extend".</p></div></div></div></div></div></div>`;
        }
        function renderTimeline() {
            const container = document.getElementById('messages-container');
            container.innerHTML = `<div class="p-4"><h3 class="text-white font-bold text-lg mb-6 pl-4 border-l-4 border-[#5865F2]">Na≈°e Spoleƒçn√° Cesta</h3><div class="relative pl-8 sm:pl-12"><div class="absolute left-[19px] top-0 bottom-0 w-0.5 bg-gradient-to-b from-[#5865F2] to-[#eb459e]"></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-shield-alt text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Kde to v≈°echno zaƒçalo ‚Äì Clash Royale</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">Zeptal jsem se tƒõ, jestli ned√°me 1v1 (samoz≈ôejmƒõ jsem vyhr√°l). <br>(P.S. Ten deck si fakt u≈æ zmƒõ≈à, a≈• m√°≈° aspo≈à teoretickou ≈°anci.)</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#3ba55c] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-mobile-alt text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Nekoneƒçn√Ω Scroll & Teorie</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">≈†est mili√≥n≈Ø poslan√Ωch Reels a hodiny konverzac√≠ o ≈æivotƒõ. Jsi jedin√Ω ƒçlovƒõk s dostateƒçn√Ωm procesorov√Ωm v√Ωkonem na to, aby pobral moje teorie (d√°v√° to smysl?).</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#faa61a] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-graduation-cap text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Discord Maratony</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">271k+ hodin vol√°n√≠. Od tv√© nekoneƒçn√© trpƒõlivosti a obƒõtavosti p≈ôi douƒçov√°n√≠ m√©ho autistick√©ho ADHD mozku a≈æ po na≈°e bitvy ve Vyzyvateli, Tetrisu, Geoguessru, Fall Guys, Super Animal Royale a Minigolfu.</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#eb459e] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-fire text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Oh√Ωnek u Vlƒçnovsk√Ωch b√∫d</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">J√° sehnal d≈ôevo, ty jsi ≈ô√≠dila. Pes n√°m se≈æral veƒçe≈ôi, potkali jsme n√°hodn√©ho Holanƒèana a j√° n√°s hrdinnƒõ br√°nil sekerou proti d≈ôevƒõn√© so≈°e (kter√° vypadala fakt podez≈ôele!). P≈ôe≈æili jsme.</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#ed4245] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-wine-glass text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Hody Ma≈ôatice</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">Veƒçer, kdy jsi mi zachr√°nila prdel. Dot√°hla jsi mƒõ do auta, vyslechla si moje opileck√© uji≈°≈•ov√°n√≠, ≈æe fakt nejsem gej, a pak jsi jen sledovala m≈Øj akrobatick√Ω p≈ôeskok p≈ôes plot.</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-star text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Pole≈°ovice</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">Prvn√≠ jako skvƒõl√Ω navig√°tor jsem vybral tu spr√°vnou odboƒçku/zkratku, abychom se mohli vyhnout hasiƒç≈Øm (predicted/foreshadowing). D√°l moje perfektn√≠ orientace ve tmƒõ, je≈°tƒõ lep≈°√≠ schopnost pozn√°v√°n√≠ hvƒõzd (letadel) a v√Ωhled na po≈æ√°r pod n√°mi. Tady jsi mƒõ poprv√© fact-checknula s Nerem a od t√© doby vƒõ≈ô√≠m m√Ωt≈Øm.</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#faa61a] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-basketball-ball text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Basketbal, Modr√° a Velehrad</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">Poprv√©, co jsem j√° ≈ô√≠dil a m√°lem n√°s sejmul autobus. Basketbalov√Ω z√°pas, kde si borec zlomil nohu. Sidequest (je≈°tƒõ s Elen) na Modrou na rozhlednu ve velk√© mlze a zimƒõ, potom dol≈Ø na Velehrad v bahnƒõ do alt√°nku k rybn√≠ku. Po v√≠c jak hodinov√©m yappov√°n√≠ na parkovi≈°ti jsme za≈°li na kebab, ale nemohli jsme si ho vychutnat kv≈Øli cajt≈Øm. Skvƒõl√Ω veƒçer.</p></div></div><div class="relative max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-gradient-to-r from-[#5865F2] to-[#eb459e] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-gift text-white text-xs"></i></div><div class="bg-gradient-to-r from-[#2f3136] to-[#202225] p-4 rounded-lg border border-[#5865F2] ml-2"><h4 class="font-bold text-white mb-1">Tento d√°rek</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">V≈°echny na≈°e vzpom√≠nky na jednom m√≠stƒõ. Diddyblud kalkulator a 5 metr≈Ø HDMI kabelu (m√≠sto ma≈°le), abys mohla nastudovat v≈°echny moje filmov√© reference.</p></div></div></div></div>`;
        }

        function renderLibrary(type) {
            const container = document.getElementById('messages-container');
            const searchInput = document.getElementById('search-input');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            let items = library[type].filter(item => item.title.toLowerCase().includes(searchTerm));
            items.sort((a, b) => {
                const aB = state.watchlist.some(w => w.id === a.id);
                const bB = state.watchlist.some(w => w.id === b.id);
                return bB - aB;
            });

            const typeName = type === 'movies' ? 'filmy' : type === 'series' ? 'seri√°ly' : 'hry';
            
            // Group by category if available, otherwise 'Ostatn√≠'
            const grouped = items.reduce((acc, item) => {
                const cat = item.cat || 'Ostatn√≠';
                if (!acc[cat]) acc[cat] = [];
                acc[cat].push(item);
                return acc;
            }, {});

            let html = `<div class="p-2 space-y-8">`; // Increased spacing between sections
            
            // Order categories for movies if present
            const categoryOrder = ["Anim√°ky & Poh√°dky", "Komedie", "Akƒçn√≠ & Sci-Fi", "Drama & Thriller", "Ostatn√≠"];
            const sortedCategories = Object.keys(grouped).sort((a, b) => {
                return categoryOrder.indexOf(a) - categoryOrder.indexOf(b);
            });

            if (items.length === 0) {
                html += `<div class="text-gray-400 italic text-center mt-10">Nic nenalezeno... :(</div>`;
            } else {
                sortedCategories.forEach(cat => {
                    if (grouped[cat]) {
                        html += `
                            <div>
                                <h3 class="text-[var(--text-header)] font-bold mb-3 uppercase text-xs tracking-wide opacity-80 border-b border-[#2f3136] pb-1 ml-1">
                                    ${cat}
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        `;
                        grouped[cat].forEach(item => {
                            const isBookmarked = state.watchlist.some(w => w.id === item.id);
                            // Pink icon if bookmarked (#eb459e)
                            const bookmarkBtnClass = isBookmarked 
                                ? 'bg-[#2f3136] text-[#eb459e] hover:text-[#d4357e]' 
                                : 'bg-[#202225] text-gray-400 hover:text-[#eb459e]';
                            
                            html += `
                                <div class="bg-[#2f3136] p-3 rounded hover:bg-[#36393f] transition library-item flex justify-between items-center group ${isBookmarked ? 'border-l-2 border-[#eb459e]' : ''}">
                                    <div class="flex items-center gap-3 overflow-hidden">
                                        <span class="text-xl flex-shrink-0">${item.icon}</span>
                                        <span class="font-medium text-[var(--text-header)] truncate text-sm">${item.title}</span>
                                    </div>
                                    <div class="flex gap-2 flex-shrink-0 opacity-100 transition">
                                        <button onclick="toggleBookmark(${item.id}, '${type}')" class="w-8 h-8 rounded ${bookmarkBtnClass} flex items-center justify-center transition" title="P≈ôidat do watchlistu">
                                            <i class="${isBookmarked ? 'fas' : 'far'} fa-bookmark"></i>
                                        </button>
                                        <button onclick="initiateDownload(${item.id})" class="w-8 h-8 rounded bg-[#202225] flex items-center justify-center text-gray-400 hover:text-[#5865F2]" title="St√°hnout">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                        html += `</div></div>`;
                    }
                });
            }
            
            html += `
                <div class="mt-8 p-4 bg-[#2f3136] rounded-lg border-l-4 border-[#5865F2] animate-fade-in">
                    <p class="text-sm text-[var(--text-normal)]">
                        <i class="fas fa-info-circle text-[#5865F2] mr-1"></i>
                        <strong>Tip:</strong> V≈°echny soubory seeduju (sd√≠l√≠m) z m√©ho PC. Klikni na <i class="fas fa-download mx-1"></i> a otev≈ôe se ti to rovnou v qBittorrentu. Rychlost by mƒõla b√Ωt fajn!
                    </p>
                </div>
            </div>`;
            container.innerHTML = html;
        }

        function renderUpgrade() {
            const container = document.getElementById('messages-container');
            container.innerHTML = `<div class="flex gap-4 items-start"><img src="discord_profilovka.jpg" 
                 alt="Jo≈æka" 
                 class="w-10 h-10 rounded-full object-cover mt-1 shadow-md"><div class="flex-1"><div class="flex items-baseline gap-2"><span class="font-bold text-[var(--text-header)]">Jo≈æka</span></div><div onclick="startConfession()" class="mt-4 bg-[#2f3136] border border-[#292b2f] rounded p-3 flex items-center gap-3 w-full max-w-sm cursor-pointer hover:bg-[#36393f] transition group"><div class="file-icon-wrapper w-10 h-10 flex items-center justify-center text-4xl text-[#5865F2]"><i class="fas fa-file-code"></i></div><div class="flex-1 min-w-0"><div class="text-[#5865F2] font-medium truncate group-hover:underline text-sm">system_patch_v2.0.exe</div><div class="text-xs text-[#b9bbbe]">1.2 MB ‚Ä¢ Executable</div></div><div class="text-[#b9bbbe] hover:text-white transition text-lg"><i class="fas fa-download"></i></div></div></div></div>`;
        }

        // --- WATCHLIST LOGIC ---
        function toggleBookmark(id, type) {
            let item;
            for(let k in library) { item = library[k].find(i => i.id === id); if(item) { item.type = type; break; } }
            const idx = state.watchlist.findIndex(w => w.id === id);
            if(idx === -1) { state.watchlist.push(item); showNotification('P≈ôid√°no', 'success'); }
            else { state.watchlist.splice(idx, 1); showNotification('Odebr√°no', 'info'); }
            localStorage.setItem('klarka_watchlist', JSON.stringify(state.watchlist));
            updateBookmarkCounter();
            if(['movies','series','games'].includes(state.currentChannel)) renderLibrary(state.currentChannel);
        }
        function updateBookmarkCounter() {
            const count = state.watchlist.length;
            document.getElementById('bookmark-count').textContent = count;
            document.getElementById('bookmark-counter').style.display = count > 0 ? 'flex' : 'none';
        }
        function showWatchlist() {
            document.getElementById('watchlist-modal').style.display = 'flex';
            const container = document.getElementById('watchlist-items');
            document.getElementById('watchlist-total').textContent = state.watchlist.length;
            if(state.watchlist.length === 0) container.innerHTML = '<div class="text-center text-gray-500 py-10">Pr√°zdno.</div>';
            else container.innerHTML = state.watchlist.map(i => `<div class="bg-[#2f3136] p-3 rounded flex justify-between items-center mb-2"><div class="flex items-center gap-3"><span class="text-xl">${i.icon}</span><span class="text-white">${i.title}</span></div><button onclick="toggleBookmark(${i.id},'${i.type}');showWatchlist()" class="text-[#ed4245]"><i class="fas fa-trash"></i></button></div>`).join('');
        }
        function clearWatchlist() {
            if(confirm('Vyƒçistit?')) { state.watchlist = []; localStorage.setItem('klarka_watchlist', '[]'); showWatchlist(); updateBookmarkCounter(); if(['movies','series','games'].includes(state.currentChannel)) renderLibrary(state.currentChannel); showNotification('Watchlist vyƒçi≈°tƒõn', 'info'); }
        }
        function exportWatchlist() {
            if(state.watchlist.length === 0) { showNotification('Watchlist je pr√°zdn√Ω!', 'warning'); return; }
            const listText = state.watchlist.map(item => `‚Ä¢ ${item.title} (${item.type === 'movies' ? 'Film' : item.type === 'series' ? 'Seri√°l' : 'Hra'})`).join('\n');
            const fullText = `üßæ N√Å≈† SPOLEƒåN√ù WATCHLIST\n\n${listText}\n\nüìÖ Vytvo≈ôeno: ${new Date().toLocaleDateString('cs-CZ')}\n‚ù§Ô∏è Tƒõ≈°√≠m se na spoleƒçn√© sledov√°n√≠!`;
            const fallbackCopy = (text) => { const textArea = document.createElement("textarea"); textArea.value = text; document.body.appendChild(textArea); textArea.select(); try { document.execCommand('copy'); showNotification('Watchlist zkop√≠rov√°n do schr√°nky!', 'success'); } catch (err) { showNotification('Nepoda≈ôilo se zkop√≠rovat text', 'error'); } document.body.removeChild(textArea); };
            if (navigator.clipboard && navigator.clipboard.writeText) navigator.clipboard.writeText(fullText).then(() => showNotification('Watchlist zkop√≠rov√°n do schr√°nky!', 'success')).catch(() => fallbackCopy(fullText));
            else fallbackCopy(fullText);
        }
        function showNotification(msg, type) {
            const div = document.createElement('div'); div.className = `fixed top-4 right-4 text-white px-4 py-2 rounded shadow-lg z-[100] ${type==='success'?'bg-[#3ba55c]':'bg-[#5865F2]'}`;
            div.innerHTML = msg; document.body.appendChild(div); setTimeout(()=>div.remove(), 3000);
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        // --- DOWNLOAD ---
        function initiateDownload(id) {
            let item = null;
            for (const category in library) { const found = library[category].find(i => i.id === id); if (found) { item = found; break; } }
            if (!item) return;
            state.currentDownload = item;
            document.getElementById('download-message').textContent = `St√°hnout "${item.title}"?`;
            document.getElementById('download-modal').style.display = 'flex';
        }

        function openMagnetLink() { 
            if (state.currentDownload && state.currentDownload.magnet) {
                // T√≠mto ≈ô√°dkem skuteƒçnƒõ "proklikne≈°" magnet link
                window.location.href = state.currentDownload.magnet;
                showNotification('Spou≈°t√≠m qBittorrent...', 'success'); 
            } else {
                showNotification('Magnet link nenalezen.', 'error');
            }
            closeModal('download-modal'); 
}
        function openGoogleDrive() { 
    if (state.currentDownload && state.currentDownload.gdrive && state.currentDownload.gdrive !== "") {
        // Otev≈ôe odkaz na Google Drive v nov√©m oknƒõ/panelu
        window.open(state.currentDownload.gdrive, '_blank');
        showNotification('Otev√≠r√°m Google Drive...', 'success'); 
    } else {
        // Pokud odkaz v datech chyb√≠, upozorn√≠me u≈æivatele
        showNotification('Odkaz na Google Drive nen√≠ k dispozici.', 'info');
    }
    closeModal('download-modal'); 
}

        // --- CONFESSION ---
        function startConfession() {
            // Play music 1
            const music1 = document.getElementById('audio-final-countdown');
            if(music1) {
                music1.currentTime = 0;
                music1.volume = 0.5;
                music1.play().catch(e => console.log("Audio play failed (user interaction needed first):", e));
            }

            const modal = document.getElementById('confession-modal');
            const output = document.getElementById('terminal-output');
            const typingArea = document.getElementById('typing-area');
            const promptText = document.getElementById('prompt-text');
            const cmdCursor = document.getElementById('cmd-cursor');
            modal.style.display = 'flex';
            output.innerHTML = `<div>Microsoft Windows [Version 10.0.19045]</div><div>(c) Microsoft Corporation. All rights reserved.</div><br>`;
            typingArea.textContent = '';
            promptText.textContent = "C:\\Users\\Kl√°rka\\Heart>";
            cmdCursor.style.display = 'inline-block';
            const command = " system_patch_v2.0.exe";
            let charIndex = 0;
            const lines = ["Loading shared memory database...", "‚úì Discord logs... OK", "‚úì Co-op games... OK", "‚úì Inside jokes... OK", "Running compatibility analysis...", ">> Humor: MATCH", ">> Values: SYNCED", "Tetris Logic: Perfect fit detected.", "Analysis complete.", "Decrypting final message..."];
            
            function typeCommand() {
                if (charIndex < command.length) { typingArea.textContent += command.charAt(charIndex); charIndex++; setTimeout(typeCommand, Math.random() * 50 + 50); } 
                else setTimeout(runLogs, 500);
            }
            function runLogs() {
                const cmdLine = document.createElement('div');
                cmdLine.innerHTML = `C:\\Users\\Kl√°rka\\Heart&gt;${command}`;
                output.appendChild(cmdLine);
                typingArea.textContent = ''; promptText.textContent = ''; cmdCursor.style.display = 'none';
                let lineIndex = 0;
                function printLine() {
                    if (lineIndex < lines.length) {
                        const div = document.createElement('div');
                        div.textContent = lines[lineIndex];
                        output.appendChild(div);
                        document.getElementById('terminal-body').scrollTop = document.getElementById('terminal-body').scrollHeight;
                        lineIndex++;
                        if(lineIndex === lines.length) {
                             const cursorSpan = document.createElement('span');
                             cursorSpan.className = 'cmd-cursor';
                             cursorSpan.innerText = ' '; // spacer
                             const pressKey = document.createElement('span');
                             pressKey.className = 'animate-pulse text-gray-500 ml-2';
                             pressKey.innerText = 'Press any key to continue...';
                             
                             const lastLine = document.createElement('div');
                             lastLine.appendChild(pressKey);
                             lastLine.appendChild(cursorSpan);
                             output.appendChild(lastLine);
                             
                             const proceed = () => {
                                document.removeEventListener('keydown', proceed);
                                document.removeEventListener('click', proceed);
                                document.getElementById('confession-modal').style.display = 'none';
                                
                                // Switch Music
                                const music1 = document.getElementById('audio-final-countdown');
                                const music2 = document.getElementById('audio-divka');
                                if(music1) {
                                    // Simple fade out logic could go here, but pause is safer for stability
                                    music1.pause();
                                }
                                if(music2) {
                                    music2.currentTime = 0;
                                    music2.volume = 0.5;
                                    music2.play().catch(e => console.log("Audio 2 play failed:", e));
                                }

                                const finalModal = document.getElementById('final-confession-modal');
                                const modalBox = document.getElementById('final-modal-box');
                                
                                document.getElementById('typing-container').innerHTML = '';
                                document.getElementById('confession-buttons').classList.add('hidden');
                                
                                finalModal.style.display = 'flex';
                                
                                setTimeout(() => {
                                    modalBox.classList.remove('opacity-0', 'scale-95');
                                    modalBox.classList.add('opacity-100', 'scale-100');
                                    setTimeout(typeFinalMessage, 500);
                                }, 50);
                             };
                             
                             // Add listeners with a small delay to prevent accidental double clicks
                             setTimeout(() => {
                                document.addEventListener('keydown', proceed);
                                document.addEventListener('click', proceed);
                             }, 500);
                        } else setTimeout(printLine, 400 + Math.random() * 400);
                    }
                }
                printLine();
            }
            typeCommand();
        }

        function typeFinalMessage() {
            const container = document.getElementById('typing-container');
            container.innerHTML = '';
            document.getElementById('confession-buttons').classList.add('hidden');
            
            const textParts = [
                { text: "Kl√°rko,", bold: true },
                { text: "hroznƒõ si v√°≈æ√≠m toho, co mezi sebou m√°me. M√°me podobn√© hodnoty, ve v≈°em si rozum√≠me a jsi neuvƒõ≈ôitelnƒõ inteligentn√≠ a klidn√°." },
                { text: "Hlavnƒõ jsi ale ƒçlovƒõk, se kter√Ωm m≈Ø≈æu b√Ωt naprosto s√°m sebou, proto≈æe v√≠m, ≈æe mƒõ bere≈° p≈ôesnƒõ takov√©ho, jak√Ω jsem." },
                { text: "M√°m tƒõ hroznƒõ r√°d.", highlight: true },
                { text: "Na≈°e p≈ô√°telstv√≠ pro mƒõ znamen√° stra≈°nƒõ moc a nikdy o nƒõj nechci p≈ôij√≠t. Z√°rove≈à ale c√≠t√≠m, ≈æe k tobƒõ m√°m mnohem bl√≠≈æ, a byl bych moc r√°d, kdybychom to spolu zkusili i jako p√°r." },
                { text: "Nechtƒõla bys to se mnou zkusit?", bold: true, center: true }
            ];
            
            let partIndex = 0;
            let charIndex = 0;
            let currentP = null;
            
            function typeChar() {
                if (partIndex >= textParts.length) {
                    setTimeout(() => {
                        const btns = document.getElementById('confession-buttons');
                        btns.classList.remove('hidden');
                        btns.classList.add('animate-fade-in');
                    }, 500);
                    return;
                }
                
                const part = textParts[partIndex];
                
                if (!currentP) {
                    currentP = document.createElement('p');
                    if (part.bold) currentP.className = "font-bold text-white text-lg";
                    if (part.highlight) currentP.className = "text-[#eb459e] font-bold text-center text-xl my-2";
                    if (part.center) currentP.className = "font-bold text-white text-center mt-4 text-lg";
                    currentP.classList.add('typing-cursor');
                    container.appendChild(currentP);
                }
                
                if (charIndex < part.text.length) {
                    currentP.textContent = part.text.substring(0, charIndex + 1);
                    charIndex++;
                    setTimeout(typeChar, 60); // Faster typing speed per char
                } else {
                    currentP.classList.remove('typing-cursor');
                    currentP = null;
                    charIndex = 0;
                    partIndex++;
                    setTimeout(typeChar, 600); // Shorter pause between lines
                }
            }
            
            typeChar();
        }

        function responseYes() { 
            document.getElementById('final-modal-content').innerHTML = `
                <div class="animate-fade-in">
                    <h2 class="text-3xl font-bold text-[#eb459e] mb-2">‚ù§Ô∏è CONNECTION ESTABLISHED! ‚ù§Ô∏è</h2>
                    <p class="text-gray-300 text-lg leading-relaxed mb-6">
                        Dƒõkuju, ≈æe jsi mi dala ≈°anci. Jsi moje kotva v cel√©m tom m√©m chaosu a slibuju, ≈æe si toho budu v√°≈æit ka≈æd√Ω den.
                        <br><br>
                        Tƒõ≈°√≠m se na v≈°echno, co n√°s ƒçek√°.
                    </p>
                    <div class="mt-8">
                        <button onclick="planDate()" class="w-full bg-gradient-to-r from-[#eb459e] to-[#5865F2] hover:opacity-90 text-white py-4 rounded-lg font-bold text-xl shadow-lg transition transform hover:scale-105">
                            Napl√°novat rande
                        </button>
                    </div>
                </div>
            `;
        }
        function responseNo() { 
            document.getElementById('final-modal-content').innerHTML = `
                <div class="animate-fade-in">
                    <h2 class="text-2xl font-bold text-white mb-4">D√≠ky za up≈ô√≠mnost, Kl√°rko.</h2>
                    <p class="text-gray-300 text-lg mb-6 leading-relaxed">
                        Moc si tƒõ v√°≈æ√≠m a jsem r√°d, ≈æe si m≈Ø≈æeme d√°l z≈Østat bl√≠zc√≠ tak, jak jsme.
                        <br><br>
                        Nic se nemƒõn√≠ ‚Äì d√°l budeme yappovat o teori√≠ch a hr√°t Tetris. üòä
                    </p>
                    <button onclick="closeModal('final-confession-modal')" class="w-full bg-[#5865F2] hover:bg-[#4752c4] text-white py-3 rounded-lg font-bold transition">
                        Zpƒõt na server
                    </button>
                </div>
            `; 
        }

        function planDate() {
            const modal = document.getElementById('final-confession-modal');
            const modalBox = document.getElementById('final-modal-box'); // Use the inner box for content replacement
            
            // Create content HTML
            const content = `
                <div class="animate-fade-in">
                    <div class="text-4xl mb-2">üìÖ</div>
                    <h2 class="text-xl font-bold text-white mb-4">Pl√°novaƒç Rande v1.0</h2>
                    <div class="space-y-4 text-left">
                        <div>
                            <label class="block text-[#b9bbbe] text-xs font-bold uppercase mb-1">Kdy m√°≈° ƒças?</label>
                            <select id="date-select" class="w-full bg-[#202225] text-white p-2.5 rounded border border-[#202225] focus:border-[#5865F2] focus:outline-none transition">
                                <option value="Co nejd≈ô√≠ve">Co nejd≈ô√≠ve! üöÄ</option>
                                <option value="Tento v√≠kend">Tento v√≠kend</option>
                                <option value="P≈ô√≠≈°t√≠ t√Ωden">P≈ô√≠≈°t√≠ t√Ωden</option>
                                <option value="Po zkou≈°k√°ch">A≈æ po zkou≈°k√°ch</option>
                                <option value="Jindy">Jindy (napi≈°u ti)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[#b9bbbe] text-xs font-bold uppercase mb-1">Co podnikneme?</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button type="button" onclick="selectActivity(this, 'Kino')" class="activity-btn bg-[#2f3136] hover:bg-[#40444b] text-white p-3 rounded text-sm font-medium transition border border-transparent hover:border-[#5865F2]">Kino üçø</button>
                                <button type="button" onclick="selectActivity(this, 'Kav√°rna')" class="activity-btn bg-[#2f3136] hover:bg-[#40444b] text-white p-3 rounded text-sm font-medium transition border border-transparent hover:border-[#5865F2]">Kav√°rna ‚òï</button>
                                <button type="button" onclick="selectActivity(this, 'Proch√°zka')" class="activity-btn bg-[#2f3136] hover:bg-[#40444b] text-white p-3 rounded text-sm font-medium transition border border-transparent hover:border-[#5865F2]">Proch√°zka üå≤</button>
                                <button type="button" onclick="selectActivity(this, 'Chill')" class="activity-btn bg-[#2f3136] hover:bg-[#40444b] text-white p-3 rounded text-sm font-medium transition border border-transparent hover:border-[#5865F2]">Chill u mƒõ üéÆ</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-[#b9bbbe] text-xs font-bold uppercase mb-1">Detaily / Pozn√°mka</label>
                            <textarea id="custom-note" class="w-full bg-[#202225] text-white p-2.5 rounded border border-[#202225] focus:border-[#5865F2] focus:outline-none transition text-sm h-20 resize-none" placeholder="Nap≈ô. na co m√°≈° chu≈•, jak√Ω film..."></textarea>
                        </div>
                    </div>
                    <button onclick="confirmDate()" class="mt-6 w-full bg-[#5865F2] hover:bg-[#4752c4] text-white py-3 rounded font-bold transition transform active:scale-95 shadow-md"><i class="fas fa-paper-plane mr-2"></i> Odeslat n√°vrh</button>
                </div>
            `;
            
            // Replace only content inside the box
            document.getElementById('final-modal-content').innerHTML = content;
        }
        function selectActivity(btn, act) {
            document.querySelectorAll('.activity-btn').forEach(b => { b.classList.remove('bg-[#5865F2]', 'border-[#5865F2]', 'selected'); b.classList.add('bg-[#2f3136]'); });
            btn.classList.remove('bg-[#2f3136]'); btn.classList.add('bg-[#5865F2]', 'selected'); btn.dataset.value = act;
        }
        function confirmDate() {
            const date = document.getElementById('date-select').value;
            const actBtn = document.querySelector('.activity-btn.selected');
            const activity = actBtn ? actBtn.dataset.value : "Nƒõco vymysl√≠me";
            const note = document.getElementById('custom-note').value;
            const message = `üìÖ **N√ÅVRH RANDE**\n\nüïí **Kdy:** ${date}\nüé≠ **Co:** ${activity}\nüìù **Pozn√°mka:** ${note || "Bez pozn√°mky"}\n\n*Odesl√°no z Kiscordu*`;
            const fallbackCopy = (text) => {
                const textArea = document.createElement("textarea"); textArea.value = text; document.body.appendChild(textArea); textArea.select();
                try { document.execCommand('copy'); showRedirect(); } catch (err) { showNotification('Chyba', 'error'); }
                document.body.removeChild(textArea);
            };
            if (navigator.clipboard && navigator.clipboard.writeText) navigator.clipboard.writeText(message).then(showRedirect).catch(() => fallbackCopy(message));
            else fallbackCopy(message);
        }
        function showRedirect() { document.getElementById('final-confession-modal').style.display = 'none'; document.getElementById('redirect-modal').style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function showNotification(msg, type) {
            const div = document.createElement('div'); div.className = `fixed top-4 right-4 text-white px-4 py-2 rounded shadow-lg z-[100] ${type==='success'?'bg-[#3ba55c]':'bg-[#5865F2]'}`;
            div.innerHTML = msg; document.body.appendChild(div); setTimeout(()=>div.remove(), 3000);
        }

        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if(e.key === 'Enter' && e.target.value.startsWith('/')) {
                const cmd = e.target.value.trim();
                if(cmd === '/sova') showNotification('ü¶â Sovy otoƒç√≠ hlavu o 270¬∞!', 'info');
                else if(cmd === '/chobotnice') showNotification('üêô Chobotnice maj√≠ modrou krev.', 'info');
                e.target.value = '';
            }
        });
        
        // MISSING FUNCTIONS RESTORED
        function inviteFriend() {
            const tempInput = document.createElement("input");
            tempInput.value = "https://kiscord.gg/invite/podoli-is-fake";
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
            showNotification("Invite link zkop√≠rov√°n! (Je to jen vtip)", "success");
        }

        function changeTheme(theme) {
            const root = document.documentElement;
            // Clear inline styles first (font-family, font-size from Tetris)
            document.body.style.fontFamily = '';
            document.body.style.fontSize = '';
            
            if (theme === 'christmas') { 
                root.style.setProperty('--bg-tertiary', '#420d0d'); 
                root.style.setProperty('--bg-secondary', '#5c1414'); 
                root.style.setProperty('--bg-primary', '#240a0a'); 
                root.style.setProperty('--blurple', '#c92a2a'); // Red
                root.style.setProperty('--green', '#ffd700'); // Gold
                root.style.setProperty('--text-header', '#ffffff');
                root.style.setProperty('--interactive-active', '#ffffff');
                root.style.setProperty('--interactive-normal', '#e8e8e8'); // Lighter text
                root.style.setProperty('--text-normal', '#f0f0f0');
            } 
            else if (theme === 'tetris') {
                root.style.setProperty('--bg-tertiary', '#0d0e15');
                root.style.setProperty('--bg-secondary', '#151620');
                root.style.setProperty('--bg-primary', '#1c1d29');
                root.style.setProperty('--blurple', '#00e5ff'); 
                root.style.setProperty('--green', '#69f0ae'); 
                root.style.setProperty('--red', '#ff5252'); 
                root.style.setProperty('--yellow', '#ffd740'); 
                root.style.setProperty('--pink', '#e040fb'); 
                root.style.setProperty('--text-normal', '#33ff00');
                root.style.setProperty('--interactive-normal', '#33ff00');
                document.body.style.fontFamily = "'Press Start 2P', cursive"; 
                document.body.style.fontSize = "0.8rem";
            }
            else { // default
                root.style.setProperty('--bg-tertiary', '#202225'); root.style.setProperty('--bg-secondary', '#2f3136'); root.style.setProperty('--bg-primary', '#36393f'); 
                root.style.setProperty('--blurple', '#5865F2');
                root.style.setProperty('--green', '#3ba55c');
                root.style.setProperty('--red', '#ed4245');
                root.style.setProperty('--yellow', '#faa61a');
                root.style.setProperty('--pink', '#eb459e');
                root.style.setProperty('--text-normal', '#dcddde');
                root.style.setProperty('--interactive-normal', '#b9bbbe');
            }
            showNotification(`T√©ma zmƒõnƒõno: ${theme}`, 'success');
        }

        // INIT
        if(state.quizAnswers.completed) { document.getElementById('login-screen').style.display = 'none'; showMainApp(); }
        const search = document.getElementById('search-input');
        if (search) search.addEventListener('input', () => { if (['movies', 'series', 'games'].includes(state.currentChannel)) renderLibrary(state.currentChannel); });
    </script>
</body>
</html>