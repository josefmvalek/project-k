<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiscord</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Consolas:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Default Discord-like colors */
            --bg-tertiary: #202225;
            --bg-secondary: #2f3136;
            --bg-primary: #36393f;
            --text-normal: #dcddde;
            --text-header: #ffffff;
            --interactive-normal: #b9bbbe;
            --interactive-hover: #dcddde;
            --interactive-active: #ffffff;
            --blurple: #5865F2;
            --blurple-hover: #4752c4;
            --green: #3ba55c;
            --red: #ed4245;
            --yellow: #faa61a;
            --pink: #eb459e;
            --font-main: 'Inter', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-primary);
            color: var(--text-normal);
            overflow: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background-color: var(--bg-tertiary); }
        .custom-scrollbar::-webkit-scrollbar-thumb { 
            background-color: #1a1b1e; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: #2c2f33; }

        /* Animations */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(235, 69, 158, 0.3); }
            50% { box-shadow: 0 0 15px rgba(235, 69, 158, 0.6); }
        }
        .pulse-glow { animation: pulse-glow 2s infinite; }

        .library-item:hover { background: rgba(79, 84, 92, 0.3); }
        .modal-backdrop { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(3px); transition: opacity 0.3s ease; }

        /* Command Prompt Look */
        .cmd-window {
            font-family: 'Consolas', monospace;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .cmd-header {
            background: #ffffff;
            color: #000;
            padding: 2px 10px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ccc;
        }
        .cmd-body {
            background-color: #0c0c0c;
            color: #cccccc;
            padding: 5px;
            height: 400px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.5;
        }
        .cmd-cursor {
            display: inline-block;
            width: 8px;
            height: 14px;
            background: #cccccc;
            animation: blink 1s infinite;
            vertical-align: text-bottom;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Typing cursor for confession */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: var(--pink);
            margin-left: 2px;
        }

        /* Dynamic Progress Bar */
        .progress-bar-dynamic {
            height: 100%;
            background: linear-gradient(90deg, var(--blurple), var(--pink));
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(235, 69, 158, 0.5);
            position: relative;
            overflow: hidden;
        }
        .progress-bar-dynamic::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col md:flex-row text-sm select-none transition-colors duration-300">

    <!-- AUDIO PLAYER PLACEHOLDERS -->
    <!-- <audio id="audio-final-countdown" src="The_Final_Countdown.mp3" preload="auto"></audio>
    <audio id="audio-divka" src="DÃ­vka_s_perlami_ve_vlasech.mp3" preload="auto"></audio> -->

    <!-- ========== INITIAL SCREENS ========== -->
    
    <!-- Screen 1: Login -->
    <div id="login-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-[#36393f] flex-col">
        <div class="bg-[#2f3136] p-10 rounded-xl shadow-2xl w-full max-w-md text-center transform transition-all" id="login-box">
            <div class="mb-6">
                <div class="text-6xl mb-2">ğŸ¦‰â¤ï¸ğŸ™</div>
                <div class="text-xs text-gray-400">Kiscord Auth System v1.0</div>
            </div>
            <h1 class="text-2xl font-bold text-white mb-2">Server Autentifikace</h1>
            <p class="text-gray-400 mb-8">Pro vstup je vyÅ¾adovÃ¡no ovÄ›Å™enÃ­ reÃ¡lnÃ© polohy.</p>
            
            <button id="verify-btn" onclick="verifyLocation()" class="w-full bg-[#5865F2] hover:bg-[#4752c4] text-white font-bold py-4 rounded-lg transition-all flex items-center justify-center gap-3 text-lg group shadow-lg">
                <i class="fas fa-satellite-dish group-hover:rotate-12 transition"></i>
                <span id="verify-text">OvÄ›Å™it polohu</span>
            </button>

            <div id="verify-status" class="mt-6 text-left hidden space-y-2 font-mono text-xs bg-[#202225] p-3 rounded">
                <div class="flex items-center gap-2 text-gray-400">
                    <i class="fas fa-circle-notch fa-spin"></i> SkenovÃ¡nÃ­ satelitÅ¯...
                </div>
            </div>
        </div>
    </div>

    <!-- Screen 2: Fact Checker Quiz -->
    <div id="quiz-screen" class="fixed inset-0 z-40 hidden bg-[#36393f] flex-col items-center justify-center p-4">
        <div class="bg-[#2f3136] rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden border border-[#202225] flex flex-col h-[700px]">
            <!-- Header -->
            <div class="p-6 bg-[#202225] border-b border-[#2f3136] flex items-center gap-4">
                <div class="w-12 h-12 rounded-full bg-[#5865F2] flex items-center justify-center text-white text-xl shadow-lg">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-white">Security Fact-Check</h2>
                    <p class="text-gray-400 text-sm">Verification Protocol</p>
                </div>
            </div>

            <!-- Quiz Content -->
            <div class="flex-1 p-8 flex flex-col justify-start pt-20 relative bg-[#36393f] overflow-y-auto">
                <div id="quiz-container" class="w-full">
                    <!-- Questions injected here -->
                </div>

                <!-- Fun Fact Area -->
                <div class="mt-auto pt-8 pb-2" id="fun-fact-container" style="display:none;">
                    <div class="border-t border-[#4f545c] pt-4 text-center opacity-70 hover:opacity-100 transition">
                         <div class="flex justify-center items-center gap-2 mb-1">
                            <span class="text-lg">ğŸ’¡</span>
                            <h4 class="font-bold text-[#b9bbbe] text-xs uppercase tracking-widest">Bonus Fun Fact</h4>
                        </div>
                        <p class="text-gray-400 text-sm italic" id="fun-fact-text">NaÄÃ­tÃ¡nÃ­ zajÃ­mavosti...</p>
                    </div>
                </div>
            </div>

            <!-- Footer Progress -->
            <div class="p-4 bg-[#2f3136] border-t border-[#202225]">
                <div class="flex justify-between text-xs text-gray-400 mb-2 font-bold tracking-wider">
                    <span>PROGRESS</span>
                    <span id="quiz-step-text">1/10</span>
                </div>
                <div class="h-3 bg-[#202225] rounded-full overflow-hidden border border-[#202225]">
                    <div id="quiz-progress" class="progress-bar-dynamic" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Screen 3: Certificate -->
    <div id="certificate-screen" class="fixed inset-0 z-40 hidden bg-[#36393f] flex-col items-center justify-center p-4">
        <div class="bg-gradient-to-br from-[#2f3136] to-[#202225] border-2 border-[#5865F2] rounded-xl shadow-2xl w-full max-w-xl overflow-hidden p-1">
            <div class="bg-[#2f3136] rounded-lg p-8 text-center">
                <div class="text-5xl mb-4">ğŸ†</div>
                <div class="text-xs uppercase tracking-widest text-[#5865F2] font-bold mb-2">OficiÃ¡lnÃ­ CertifikÃ¡t</div>
                <h2 class="text-2xl font-bold text-white mb-2">VRCHNÃ FACT-CHECKER</h2>
                <div class="text-gray-400 mb-6">UdÄ›leno uÅ¾ivateli</div>
                
                <div class="text-4xl font-bold text-white bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent mb-6">
                    KlÃ¡rka
                </div>
                
                <div class="text-gray-300 mb-8">
                    Za prokÃ¡zÃ¡nÃ­ znalosti mÃ½ch chyb, omylÅ¯ a vÅ¡ech inside jokes.<br>
                    <span class="text-sm text-gray-400">(A za tolerovÃ¡nÃ­ mÃ©ho mÃ­rnÃ©ho autismu)</span>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-[#202225] p-3 rounded">
                        <div class="text-xs text-gray-400">SkÃ³re</div>
                        <div class="text-xl font-bold text-white" id="quiz-score">0%</div>
                    </div>
                    <div class="bg-[#202225] p-3 rounded">
                        <div class="text-xs text-gray-400">Datum</div>
                        <div class="text-xl font-bold text-white" id="cert-date"></div>
                    </div>
                </div>
                
                <button onclick="showMainApp()" class="bg-[#5865F2] hover:bg-[#4752c4] text-white font-bold py-3 px-8 rounded-lg transition">
                    <i class="fas fa-door-open mr-2"></i>Vstoupit do Kiscordu
                </button>
            </div>
        </div>
    </div>

    <!-- ========== MAIN APP ========== -->
    <div id="app-interface" class="flex w-full h-full hidden opacity-0 transition-opacity duration-1000">
        
        <!-- SERVER LIST -->
        <div class="bg-[var(--bg-tertiary)] w-[72px] flex flex-col items-center py-3 gap-2 flex-shrink-0 border-r border-[var(--bg-tertiary)]">
            <!-- Home Icon -->
            <div class="w-12 h-12 bg-[var(--bg-primary)] rounded-full hover:rounded-2xl hover:bg-[var(--blurple)] transition-all cursor-pointer flex items-center justify-center text-[var(--text-normal)] hover:text-white mb-2">
                <i class="fab fa-discord text-xl"></i>
            </div>
            <div class="w-8 h-[2px] bg-[var(--bg-primary)] rounded mb-2"></div>
            
            <!-- Our Server Icon -->
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl cursor-pointer flex items-center justify-center overflow-hidden">
                <div class="w-12 h-12 rounded-2xl cursor-pointer flex items-center justify-center overflow-hidden shadow-lg group transition-all duration-200">
                    <img src="Czippel2_vanoce.png" 
                        alt="K&T Server" 
                        class="w-full h-full object-cover">
                </div>
            </div>
        </div>

        <!-- CHANNEL LIST -->
        <div class="bg-[var(--bg-secondary)] w-60 flex flex-col flex-shrink-0 border-r border-[var(--bg-tertiary)]">
            <!-- Server Header -->
            <div class="h-12 border-b border-[var(--bg-tertiary)] flex items-center justify-between px-4 font-bold text-[var(--text-header)] hover:bg-[#34373c] cursor-pointer transition">
                <span class="truncate">ğŸ VÃ¡noÄnÃ­ DÃ¡rek 2025</span>
                <i class="fas fa-chevron-down text-xs"></i>
            </div>

            <!-- Scrollable Channels -->
            <div class="flex-1 overflow-y-auto py-3 custom-scrollbar">
                <!-- Channels are managed by JS -->
                <div id="channels-container"></div>
            </div>

            <!-- User Profile -->
            <div class="h-[52px] bg-[var(--bg-tertiary)] flex items-center px-2 w-full">
    <div class="relative w-8 h-8 mr-2 cursor-pointer group">
        <img src="klarka_profilovka.webp" 
             alt="KlÃ¡rka" 
             class="w-8 h-8 rounded-full object-cover">
        
        <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-[var(--green)] rounded-full border-2 border-[#292b2f]"></div>
    </div>

    <div class="flex-1 overflow-hidden">
        <div class="text-[var(--text-header)] text-xs font-bold truncate">KlÃ¡rka</div>
        <div class="text-[var(--interactive-normal)] text-[10px] truncate">#1337 â€¢ <span id="user-status">Online</span></div>
    </div>
</div>
        </div>

        <!-- MAIN CONTENT AREA -->
        <div class="bg-[var(--bg-primary)] flex-1 flex flex-col min-w-0 relative">
            <!-- Top Bar -->
            <div class="h-12 border-b border-[var(--bg-tertiary)] flex items-center px-4 shadow-sm">
                <i id="channel-icon" class="fas fa-hashtag text-gray-500 text-xl mr-2"></i>
                <span id="channel-name" class="font-bold text-[var(--text-header)] mr-4">uvÃ­tÃ¡nÃ­</span>
                <span id="channel-desc" class="text-xs text-[var(--interactive-normal)] truncate hidden md:block">VeselÃ© VÃ¡noce!</span>
                
                <div class="ml-auto flex items-center gap-4 text-[var(--interactive-normal)]">
                    <!-- Bookmark Counter -->
                    <div id="bookmark-counter" class="hidden bg-[var(--bg-tertiary)] px-2 py-1 rounded text-xs flex items-center gap-2 cursor-pointer hover:text-white" onclick="showWatchlist()" title="Watchlist">
                        <i class="fas fa-bookmark text-[var(--pink)]"></i>
                        <span id="bookmark-count">0</span>
                    </div>
                    
                    <!-- Search -->
                    <div class="bg-[var(--bg-tertiary)] px-2 py-1 rounded text-xs flex items-center gap-2 w-32 md:w-48">
                        <input type="text" placeholder="Hledat..." class="bg-transparent text-white focus:outline-none w-full" id="search-input">
                        <i class="fas fa-search text-xs"></i>
                    </div>
                </div>
            </div>

            <!-- Messages/Content Area -->
            <div id="messages-container" class="flex-1 overflow-y-auto px-4 py-4 custom-scrollbar flex flex-col gap-4 transition-colors duration-300">
                <!-- Content will be injected here -->
            </div>

            <!-- Message Input (disabled for most channels) -->
            <div class="px-4 pb-6 pt-2">
                <div class="bg-[#40444b] rounded-lg px-4 py-3 flex items-center gap-3">
                    <input type="text" id="main-input" placeholder="Tento kanÃ¡l je jen pro ÄtenÃ­ (nebo tajnÃ© pÅ™Ã­kazy?)" class="bg-transparent text-[var(--interactive-normal)] flex-1 focus:outline-none placeholder-gray-500">
                </div>
            </div>
        </div>

        <!-- MEMBER LIST -->
        <div class="w-60 bg-[var(--bg-secondary)] hidden lg:flex flex-col p-3 flex-shrink-0 border-l border-[var(--bg-tertiary)]">
            <h3 class="text-xs font-bold text-[#8e9297] uppercase mb-2 px-2">ONLINE â€” 2</h3>
            
            <!-- Me -->
            <div class="flex items-center gap-3 px-2 py-1.5 rounded hover:bg-[var(--bg-primary)] cursor-pointer group">
                <div class="relative">
                    <img src="discord_profilovka.jpg" alt="JoÅ¾ka" class="w-8 h-8 rounded-full object-cover">
                    <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-[var(--green)] rounded-full border-2 border-[#2f3136]"></div>
                </div>
                <div>
                    <div class="font-bold text-gray-200 text-sm">JoÅ¾ka</div>
                    <div class="text-xs text-gray-400">Hraje <span class="text-[var(--interactive-normal)]">Tetris</span></div>
                </div>
            </div>

            <!-- Her -->
            <div class="flex items-center gap-3 px-2 py-1.5 rounded hover:bg-[var(--bg-primary)] cursor-pointer group mt-1">
                <div class="relative">
                    <img src="klarka_profilovka.webp" alt="KlÃ¡rka" class="w-8 h-8 rounded-full object-cover">
                    <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-[var(--green)] rounded-full border-2 border-[#2f3136]"></div>
                </div>
                <div>
                    <div class="font-bold text-gray-200 text-sm">KlÃ¡rka</div>
                    <div class="text-xs text-gray-400">Fact-Checkuje mÃ½ty</div>
                </div>
            </div>

            <!-- Themes -->
            <div class="mt-auto pt-6 border-t border-[var(--bg-tertiary)]">
                <div class="text-xs font-bold text-[#8e9297] uppercase px-2 mb-2">TÃ©ma</div>
                <div class="flex gap-2 px-2">
                    <button onclick="changeTheme('default')" class="flex-1 bg-[var(--blurple)] hover:opacity-90 text-white p-1 rounded text-[10px] shadow-sm">Discord</button>
                    <button onclick="changeTheme('christmas')" class="flex-1 bg-[#c92a2a] hover:opacity-90 text-white p-1 rounded text-[10px] shadow-sm">VÃ¡noce</button>
                    <button onclick="changeTheme('tetris')" class="flex-1 bg-[#a000f0] hover:opacity-90 text-white p-1 rounded text-[10px] shadow-sm">Tetris</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODALS ========== -->
    
    <!-- Download Modal -->
    <div id="download-modal" class="fixed inset-0 z-50 hidden modal-backdrop items-center justify-center p-4">
        <div class="bg-[#36393f] rounded-xl shadow-2xl w-full max-w-md border border-[#202225] overflow-hidden">
            <div class="p-6">
                <div class="text-5xl text-center mb-4">ğŸ§²</div>
                <h3 class="font-bold text-white text-center text-xl mb-2">StahovÃ¡nÃ­</h3>
                <p class="text-gray-300 text-center mb-6" id="download-message"></p>
                
                <div class="space-y-4">
                    <button onclick="openMagnetLink()" class="w-full bg-[#5865F2] hover:bg-[#4752c4] text-white py-3 rounded-lg font-bold flex items-center justify-center gap-3">
                        <i class="fas fa-magnet"></i>
                        OtevÅ™Ã­t v qBittorrent
                    </button>
                    <button onclick="openGoogleDrive()" class="w-full bg-[#3ba55c] hover:bg-[#2d7d46] text-white py-3 rounded-lg font-bold flex items-center justify-center gap-3">
                        <i class="fab fa-google-drive"></i>
                        Google Drive (zÃ¡loÅ¾nÃ­)
                    </button>
                    <button onclick="closeModal('download-modal')" class="w-full bg-[#4f545c] hover:bg-[#5d6269] text-white py-3 rounded-lg">
                        ZruÅ¡it
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Watchlist Modal -->
    <div id="watchlist-modal" class="fixed inset-0 z-50 hidden modal-backdrop items-center justify-center p-4">
        <div class="bg-[#36393f] rounded-xl shadow-2xl w-full max-w-2xl border border-[#202225] overflow-hidden max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-[#202225] flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <h3 class="font-bold text-white text-xl flex items-center gap-3">
                        <i class="fas fa-bookmark text-[#eb459e]"></i>
                        TvÅ¯j Watchlist
                    </h3>
                    <p class="text-gray-400 text-sm mt-1 ml-2">PoloÅ¾ky k spoleÄnÃ©mu sledovÃ¡nÃ­</p>
                </div>
                <button onclick="closeModal('watchlist-modal')" class="text-gray-400 hover:text-white transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="watchlist-items" class="p-6 overflow-y-auto flex-1">
                <!-- Watchlist items will be injected here -->
            </div>
            
            <div class="p-6 border-t border-[#202225] flex justify-between">
                <div class="text-gray-400 text-sm">
                    <span id="watchlist-total">0</span> poloÅ¾ek
                </div>
                <div class="space-x-3">
                    <button onclick="exportWatchlist()" class="bg-[#5865F2] hover:bg-[#4752c4] text-white px-4 py-2 rounded text-sm">
                        <i class="fas fa-share mr-1"></i>Exportovat
                    </button>
                    <button onclick="clearWatchlist()" class="bg-[#4f545c] hover:bg-[#5d6269] text-white px-4 py-2 rounded text-sm">
                        <i class="fas fa-trash mr-1"></i>VyÄistit
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confession Terminal (CMD Style) -->
    <div id="confession-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-transparent backdrop-blur-sm">
        <div class="cmd-window w-full max-w-3xl rounded-none border border-[#444] cursor-text" onclick="document.getElementById('hidden-input').focus()">
             <!-- Hidden input to capture keypress on mobile/desktop -->
            <input type="text" id="hidden-input" class="opacity-0 absolute" style="top: -1000px">
            
            <div class="cmd-header">
                <div class="flex items-center gap-2">
                    <i class="fas fa-terminal text-[10px]"></i>
                    <span>Administrator: C:\Windows\System32\cmd.exe</span>
                </div>
                <div class="flex gap-2">
                    <div class="w-3 h-3 bg-gray-400"></div>
                    <div class="w-3 h-3 bg-gray-400"></div>
                    <div class="w-3 h-3 bg-red-500 cursor-pointer" onclick="closeModal('confession-modal')"></div>
                </div>
            </div>
            <div class="cmd-body" id="terminal-body">
                <div id="terminal-output"></div>
                <div class="flex">
                    <span id="prompt-text">C:\KlÃ¡rka\Heart&gt;</span>
                    <span id="typing-area" class="ml-2"></span>
                    <span id="cmd-cursor" class="cmd-cursor ml-1"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Final Confession UI -->
    <div id="final-confession-modal" class="fixed inset-0 z-50 hidden modal-backdrop items-center justify-center p-4">
        <div class="bg-[#36393f] rounded-xl shadow-2xl w-full max-w-md border border-[#5865F2] overflow-hidden relative animate-fade-in" id="final-modal-box">
            <!-- Close Button -->
            <button onclick="closeModal('final-confession-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
            
            <div class="p-8 text-center" id="final-modal-content">
                <!-- No title as requested -->
                
                <div id="typing-container" class="text-gray-300 mb-8 text-left space-y-4 leading-relaxed min-h-[200px] mt-8">
                    <!-- Text will be typed here -->
                </div>
                
                <div id="confession-buttons" class="space-y-3 hidden">
                    <button onclick="responseYes()" class="w-full bg-gradient-to-r from-[#eb459e] to-[#5865F2] hover:opacity-90 text-white py-4 rounded-lg font-bold text-lg transition shadow-lg">
                        Ano, pojÄme to zkusit <i class="fas fa-heart ml-2"></i>
                    </button>
                    <button onclick="responseNo()" class="w-full bg-[#4f545c] hover:bg-[#5d6269] text-white py-3 rounded-lg transition">
                        ZÅ¯staÅˆme kamarÃ¡di
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Redirect Prompt Modal -->
    <div id="redirect-modal" class="fixed inset-0 z-[60] hidden modal-backdrop items-center justify-center p-4">
        <div class="bg-[#36393f] rounded-xl shadow-2xl w-full max-w-sm border border-[#202225] p-6 text-center">
            <div class="text-4xl mb-3 text-[#3ba55c]"><i class="fas fa-check-circle"></i></div>
            <h3 class="text-xl font-bold text-white mb-2">NÃ¡vrh zkopÃ­rovÃ¡n!</h3>
            <p class="text-gray-300 mb-6 text-sm">Informace o rande byly uloÅ¾eny do schrÃ¡nky. MÅ¯Å¾eÅ¡ mi je poslat na Discordu (CTRL+V).</p>
            <div class="flex gap-2">
                <a href="https://discord.com/app" target="_blank" class="flex-1 bg-[#5865F2] hover:bg-[#4752c4] text-white py-2 rounded font-bold text-sm">
                    PÅ™ejÃ­t na Discord
                </a>
                <button onclick="closeModal('redirect-modal')" class="flex-1 bg-[#4f545c] hover:bg-[#5d6269] text-white py-2 rounded font-bold text-sm">
                    ZavÅ™Ã­t
                </button>
            </div>
        </div>
    </div>

    <!-- ========== JAVASCRIPT ========== -->
    <script>
        // --- GLOBAL STATE ---
        const state = {
            currentChannel: 'welcome',
            watchlist: JSON.parse(localStorage.getItem('klarka_watchlist')) || [],
            quizAnswers: JSON.parse(localStorage.getItem('klarka_quiz')) || { score: 0, completed: false },
            currentDownload: null,
            terminalIndex: 0
        };

        // --- QUIZ DATA ---
        const quizQuestions = [
            { question: "SeznÃ¡mili jsme se kvÅ¯li Å¡kole.", correct: false, explanation: "Bylo to kvÅ¯li Clashku, ale prosÃ­m tÄ›, zmÄ›Åˆ si deck aÅ¥ mÃ¡Å¡ taky nÄ›kdy Å¡anci mÄ› porazit." },
            { question: "PodolÃ­ je samostatnÃ¡ obec.", correct: false, explanation: "Je to jenom ÄÃ¡st Kunovic. SmiÅ™ se s tÃ­m, ÄÃ­m dÅ™Ã­v to pÅ™ijmeÅ¡, tÃ­m lÃ­p pro tebe (prostÄ› jsi Kunovjanka)." },
            { question: "Å½eny jsou Å¡patnÃ© Å™idiÄky.", correct: false, explanation: "Jsi mÅ¯j osobnÃ­ Uber a zvlÃ¡dÃ¡Å¡ to aj bez svÄ›tel a pod vlivem... :-)." },
            { question: "PÅ™i tÃ¡borÃ¡ku nÃ¡m pes seÅ¾ral Å™Ã­zek.", correct: false, explanation: "Byl to Å¡pekÃ¡Äek. ZlodÄ›j, nevÃ­m, jestli nÃ¡hodou nebyl ÄernÃ½, ale vÃ­m, Å¾e vypadal jak Å¡pekÃ¡Äek." },
            { question: "Nero hrÃ¡l na lyru, zatÃ­mco Å˜Ã­m lehl popelem.", correct: false, explanation: "Je to mÃ½tus, jo, vÄ›Å™Ã­m v mÃ½ty a legendy, aj dÃ­ky tomu byl vÃ½let do PoleÅ¡ovic legendÃ¡rnÃ­. VÃ¡Å¾Ã­m si toho, Å¾e jsi mÅ¯j osobnÃ­ fact-checker." },
            { question: "UmÃ­m poznat vÅ¡echny hvÄ›zdy na obloze.", correct: true, explanation: "UmÃ­m je poznat, jenom jim dÃ¡m novÃ¡ kreativnÃ­ jmÃ©na jako â€vrtulnÃ­kâ€œ nebo â€letadloâ€œ. Why so Sirius?" },
            { question: "Jsem nejlepÅ¡Ã­ hrÃ¡Ä Geoguessru na svÄ›tÄ›.", correct: true, explanation: "VÅ¡ude jsem byl, vÅ¡ude to znÃ¡m, nikdy jsi mÄ› neporazila, mÃ¡m prostÄ› orientaÄnÃ­ smysl pravÃ©ho skauta." },
            { question: "NejlepÅ¡Ã­ vÄ›c, co se dÃ¡ koupit, je Casio kalkulaÄka.", correct: true, explanation: "Ale jenom do chvÃ­le, neÅ¾ poznÃ¡Å¡ tu plyÅ¡ovou s pÃ­skÃ¡tkem." },
            { question: "Popcorn je ideÃ¡lnÃ­ snack k filmu.", correct: false, explanation: "Sere se mezi zuby, tak snad budou ty Tetris gumÃ­dky ok." },
            { question: "SezenÃ­ u poÄÃ­taÄe a sprchovÃ¡nÃ­ jsou bezpeÄnÃ© aktivity.", correct: false, explanation: "MÅ¯Å¾eme se zeptat tvÃ©ho pÅ™isedlÃ©ho/zlomenÃ©ho kotnÃ­ku." },
             { question: "BrÃ½le jsou nutnÃ© k tomu, aby ÄlovÄ›k vidÄ›l.", correct: false, explanation: "Aj bez brÃ½lÃ­ vidÃ­Å¡ moji retardaci/autismus/ADHD a teorie, kterÃ© nikdo jinÃ½ nechÃ¡pe." }
        ];

        // Ensure unique random facts
        const funFacts = [
            "ğŸ™ Chobotnice majÃ­ tÅ™i srdce. DvÄ› pumpujÃ­ krev do Å¾Ã¡ber a jedno do zbytku tÄ›la.",
            "ğŸ¦‰ Sovy nemohou hÃ½bat oÄima v dÅ¯lcÃ­ch, proto musÃ­ otÃ¡Äet celou hlavou (aÅ¾ o 270Â°).",
            "ğŸ™ Chobotnice mÃ¡ modrou krev, protoÅ¾e obsahuje mÄ›Ä mÃ­sto Å¾eleza.",
            "ğŸ¦‰ Sovy slyÅ¡Ã­ koÅ™ist i pod snÄ›hem dÃ­ky asymetricky umÃ­stÄ›nÃ½m uÅ¡Ã­m.",
            "ğŸ™ Chobotnice jsou mistry ÃºnikÅ¯ a dokÃ¡Å¾ou se protÃ¡hnout jakÃ½mkoliv otvorem vÄ›tÅ¡Ã­m neÅ¾ jejich zobÃ¡k.",
            "ğŸ¦‰ SkupinÄ› sov se v angliÄtinÄ› Å™Ã­kÃ¡ 'parliament' (parlament).",
            "ğŸ™ Chobotnice dokÃ¡Å¾ou mÄ›nit barvu a texturu kÅ¯Å¾e bÄ›hem zlomku sekundy.",
            "ğŸ¦‰ NÄ›kterÃ© sovy (jako VÃ½r velkÃ½) lovÃ­ i menÅ¡Ã­ sovy.",
            "ğŸ™ Chobotnice jsou jedny z nejinteligentnÄ›jÅ¡Ã­ch bezobratlÃ½ch, pouÅ¾Ã­vajÃ­ nÃ¡stroje.",
            "ğŸ¦‰ SovÃ­ peÅ™Ã­ je uzpÅ¯sobeno pro naprosto tichÃ½ let."
        ];
        let availableFacts = [...funFacts];

        const library = {
            movies: [
                {id:103,title:"Angry Birds",icon:"ğŸ¦",cat:"AnimÃ¡ky & PohÃ¡dky",magnet:"",gdrive:""},
                {id:116,title:"Shrek",icon:"ğŸ§…",cat:"AnimÃ¡ky & PohÃ¡dky",magnet:"",gdrive:""},
                {id:128,title:"Za plotem",icon:"ğŸ¦",cat:"AnimÃ¡ky & PohÃ¡dky",magnet:"",gdrive:""},
                {id:127,title:"ÃšÅ¾asÅˆÃ¡kovi",icon:"ğŸ¦¸",cat:"AnimÃ¡ky & PohÃ¡dky",magnet:"",gdrive:""},
                {id:113,title:"Rango",icon:"ğŸ¦",cat:"AnimÃ¡ky & PohÃ¡dky",magnet:"",gdrive:""},
                {id:5,title:"Klaus",icon:"ğŸ…",cat:"AnimÃ¡ky & PohÃ¡dky",magnet:"",gdrive:""},
                {id:104,title:"Asterix a Obelix",icon:"ğŸ—",cat:"Komedie",magnet:"",gdrive:""},
                {id:101,title:"21 Jump Street",icon:"ğŸ‘®",cat:"Komedie",magnet:"",gdrive:""},
                {id:102,title:"22 Jump Street",icon:"ğŸš”",cat:"Komedie",magnet:"",gdrive:""},
                {id:122,title:"Borat",icon:"ğŸ‘",cat:"Komedie",magnet:"magnet:?xt=urn:btih:4a80c302f3443fb48374ee2fd74a0fc7b637ffe2&dn=Borat%20%282006%29%20FHD%20cz%20en.mkv&xl=2050976063",gdrive:"https://drive.google.com/file/d/1yTGPSkYW4KskCqjXb9PlSeNYSsuoOqoG/view?usp=sharing"},
                {id:118,title:"The Hangover",icon:"ğŸ˜µ",cat:"Komedie",magnet:"",gdrive:""},
                {id:124,title:"DrÅ¾ hubu!",icon:"ğŸ¤",cat:"Komedie",magnet:"",gdrive:""},
                {id:123,title:"DÄ›dictvÃ­",icon:"ğŸšœ",cat:"Komedie",magnet:"",gdrive:""},
                {id:115,title:"Scary Movie 1-5",icon:"ğŸ‘»",cat:"Komedie",magnet:"",gdrive:""},
                {id:2,title:"The Dark Knight",icon:"ğŸ¦‡",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:3,title:"Interstellar",icon:"ğŸš€",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:7,title:"The Matrix",icon:"ğŸ’Š",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:105,title:"Deadpool",icon:"âš”ï¸",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:110,title:"Logan",icon:"ğŸº",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:107,title:"Guardians of the Galaxy",icon:"ğŸŒŒ",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:114,title:"Ready Player One",icon:"ğŸ•¶ï¸",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:121,title:"Alien",icon:"ğŸ‘½",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:111,title:"Mad Max: Fury Road",icon:"ğŸ”¥",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:108,title:"Kill Bill: Vol. 1",icon:"ğŸ—¡ï¸",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:119,title:"LOTR Trilogie",icon:"ğŸ’",cat:"AkÄnÃ­ & Sci-Fi",magnet:"",gdrive:""},
                {id:1,title:"The Shawshank Redemption",icon:"ğŸ”“",cat:"Drama & Thriller",magnet:"",gdrive:""},
                {id:4,title:"Pulp Fiction",icon:"ğŸ”",cat:"Drama & Thriller",magnet:"",gdrive:""},
                {id:6,title:"Fight Club",icon:"ğŸ‘Š",cat:"Drama & Thriller",magnet:"",gdrive:""},
                {id:8,title:"Whiplash",icon:"ğŸ¥",cat:"Drama & Thriller",magnet:"",gdrive:""},
                {id:106,title:"Donnie Darko",icon:"ğŸ°",cat:"Drama & Thriller",magnet:"",gdrive:""},
                {id:112,title:"Prisoners",icon:"ğŸ”¦",cat:"Drama & Thriller",magnet:"",gdrive:""},
                {id:125,title:"Seven",icon:"ğŸ“¦",cat:"Drama & Thriller",magnet:"",gdrive:""},
                {id:126,title:"The Social Network",icon:"ğŸ‘",cat:"Drama & Thriller",magnet:"",gdrive:""},
                {id:109,title:"Le Mans 66",icon:"ğŸï¸",cat:"Drama & Thriller",magnet:"",gdrive:""},
                {id:117,title:"The Gentlemen",icon:"ğŸ¥ƒ",cat:"Drama & Thriller",magnet:"",gdrive:""},
                {id:120,title:"The Thing",icon:"â„ï¸",cat:"Drama & Thriller",magnet:"",gdrive:""}
            ],
            series: [{id:9,title:"Breaking Bad",icon:"ğŸ§ª",magnet:"",gdrive:""},{id:10,title:"Arcane",icon:"âš¡",magnet:"",gdrive:""},{id:11,title:"Mr. Robot",icon:"ğŸ’»",magnet:"",gdrive:""},{id:12,title:"True Detective S1",icon:"ğŸ•µï¸",magnet:"",gdrive:""}],
            games: [{id:13,title:"Tetris Effect",icon:"ğŸ§©",magnet:"",gdrive:""},{id:14,title:"Hades",icon:"âš¡",magnet:"",gdrive:""},{id:15,title:"Dead Cells",icon:"ğŸ’€",magnet:"",gdrive:""},{id:16,title:"Portal 2",icon:"ğŸŒ€",magnet:"",gdrive:""},{id:301,title:"Balatro",icon:"ğŸƒ",magnet:"",gdrive:""},{id:302,title:"Brotato",icon:"ğŸ¥”",magnet:"",gdrive:""},{id:303,title:"Kingdom: Two Crowns",icon:"ğŸ‘‘",magnet:"",gdrive:""},{id:304,title:"Mafia II: DE",icon:"ğŸ”«",magnet:"",gdrive:""},{id:305,title:"Papa's Freezeria",icon:"ğŸ¦",magnet:"",gdrive:""},{id:306,title:"Stackflow",icon:"ğŸ’»",magnet:"",gdrive:""},{id:307,title:"Enter the Gungeon",icon:"ğŸ”«",magnet:"",gdrive:""},{id:308,title:"Hades II",icon:"ğŸŒ™",magnet:"",gdrive:""},{id:309,title:"Jump King",icon:"ğŸ‘‘",magnet:"",gdrive:""}]
        };

        // --- CORE FUNCTIONS ---
        function getUniqueFunFact() {
            if (availableFacts.length === 0) availableFacts = [...funFacts];
            return availableFacts.splice(Math.floor(Math.random() * availableFacts.length), 1)[0];
        }

        function verifyLocation() {
            const btn = document.getElementById('verify-btn');
            const status = document.getElementById('verify-status');
            const text = document.getElementById('verify-text');
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');
            text.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> OvÄ›Å™ovÃ¡nÃ­...';
            status.classList.remove('hidden');
            const steps = ["ğŸ“¡ PÅ™ipojovÃ¡nÃ­ k satelitu...", "ğŸ“ Triangulace pozice...", "âŒ PodolÃ­... 404 Not Found", "âœ… Kunovice... NALEZENO"];
            let i = 0;
            const interval = setInterval(() => {
                if (i < steps.length) {
                    const div = document.createElement('div');
                    div.className = i === 2 ? 'text-red-400' : (i === 3 ? 'text-green-400 font-bold' : 'text-gray-400');
                    div.innerHTML = steps[i];
                    status.appendChild(div);
                    i++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('login-screen').style.display = 'none';
                        showQuiz();
                    }, 1000);
                }
            }, 800);
        }

        function changeTheme(theme) {
            const root = document.documentElement;
            // Clear inline styles first (font-family, font-size from Tetris)
            document.body.style.fontFamily = '';
            document.body.style.fontSize = '';
            
            if (theme === 'christmas') { 
                root.style.setProperty('--bg-tertiary', '#420d0d'); 
                root.style.setProperty('--bg-secondary', '#5c1414'); 
                root.style.setProperty('--bg-primary', '#240a0a'); 
                root.style.setProperty('--blurple', '#c92a2a'); // Red
                root.style.setProperty('--green', '#ffd700'); // Gold
                root.style.setProperty('--text-header', '#ffffff');
                root.style.setProperty('--interactive-active', '#ffffff');
                root.style.setProperty('--interactive-normal', '#e8e8e8'); // Lighter text
                root.style.setProperty('--text-normal', '#f0f0f0');
            } 
            else if (theme === 'tetris') {
                root.style.setProperty('--bg-tertiary', '#0d0e15');
                root.style.setProperty('--bg-secondary', '#151620');
                root.style.setProperty('--bg-primary', '#1c1d29');
                root.style.setProperty('--blurple', '#00e5ff'); 
                root.style.setProperty('--green', '#69f0ae'); 
                root.style.setProperty('--red', '#ff5252'); 
                root.style.setProperty('--yellow', '#ffd740'); 
                root.style.setProperty('--pink', '#e040fb'); 
                root.style.setProperty('--text-normal', '#33ff00');
                root.style.setProperty('--interactive-normal', '#33ff00');
                document.body.style.fontFamily = "'Press Start 2P', cursive"; 
                document.body.style.fontSize = "0.8rem";
            }
            else { // default
                root.style.setProperty('--bg-tertiary', '#202225'); root.style.setProperty('--bg-secondary', '#2f3136'); root.style.setProperty('--bg-primary', '#36393f'); 
                root.style.setProperty('--blurple', '#5865F2');
                root.style.setProperty('--green', '#3ba55c');
                root.style.setProperty('--red', '#ed4245');
                root.style.setProperty('--yellow', '#faa61a');
                root.style.setProperty('--pink', '#eb459e');
                root.style.setProperty('--text-normal', '#dcddde');
                root.style.setProperty('--interactive-normal', '#b9bbbe');
            }
            showNotification(`TÃ©ma zmÄ›nÄ›no: ${theme}`, 'success');
        }

        // --- QUIZ ---
        function showQuiz() {
            document.getElementById('quiz-screen').style.display = 'flex';
            loadQuizQuestion(0);
        }
        function loadQuizQuestion(index) {
            const container = document.getElementById('quiz-container');
            const progress = ((index) / quizQuestions.length) * 100;
            document.getElementById('quiz-progress').style.width = `${progress}%`;
            document.getElementById('quiz-step-text').innerText = `${index + 1}/${quizQuestions.length}`;
            if (index >= quizQuestions.length) { finishQuiz(); return; }
            const q = quizQuestions[index];
            container.innerHTML = `<div class="mb-10 text-center"><h3 class="text-white font-extrabold text-2xl leading-relaxed">${q.question}</h3></div><div id="quiz-options" class="flex flex-col gap-4"><button onclick="answerQuiz(${index}, true)" class="w-full bg-[#2f3136] hover:bg-[#3ba55c] text-left px-4 py-4 rounded border border-[#202225] hover:border-[#3ba55c] transition flex items-center group"><div class="w-6 h-6 rounded-full border-2 border-gray-500 group-hover:border-white mr-3 flex items-center justify-center"></div><span class="text-gray-300 group-hover:text-white font-medium text-lg">FAKT</span></button><button onclick="answerQuiz(${index}, false)" class="w-full bg-[#2f3136] hover:bg-[#ed4245] text-left px-4 py-4 rounded border border-[#202225] hover:border-[#ed4245] transition flex items-center group"><div class="w-6 h-6 rounded-full border-2 border-gray-500 group-hover:border-white mr-3 flex items-center justify-center"></div><span class="text-gray-300 group-hover:text-white font-medium text-lg">MÃTUS</span></button></div><div id="quiz-result-feedback" class="hidden mt-4 pt-4 border-t border-[#36393f]"></div>`;
            document.getElementById('fun-fact-container').style.display = 'block';
            document.getElementById('fun-fact-text').innerText = getUniqueFunFact();
        }
        function answerQuiz(index, answer) {
            const q = quizQuestions[index];
            const correct = (answer === q.correct);
            if (!state.quizAnswers.completed && correct) state.quizAnswers.score += 10;
            document.getElementById('quiz-options').style.display = 'none';
            const feedback = document.getElementById('quiz-result-feedback');
            feedback.innerHTML = `
                <div class="mb-6 p-4 bg-[#202225] rounded-lg border-l-4 ${correct ? 'border-green-500' : 'border-red-500'}">
                    <h4 class="${correct?'text-green-400':'text-red-400'} font-bold text-xl mb-2 flex items-center">
                        <i class="fas ${correct?'fa-check-circle':'fa-times-circle'} mr-2"></i>
                        ${correct?'SprÃ¡vnÄ›!':'Ups!'}
                    </h4>
                    <p class="text-white text-lg leading-relaxed mt-2">${q.explanation}</p>
                </div>
                <button onclick="loadQuizQuestion(${index + 1})" class="w-full bg-[#5865F2] hover:bg-[#4752c4] text-white py-4 rounded-lg font-bold text-xl shadow-md transition transform hover:scale-[1.02]">
                    ${index + 1 < quizQuestions.length ? 'DalÅ¡Ã­ otÃ¡zka âœ' : 'DokonÄit ğŸ‰'}
                </button>
            `;
            feedback.classList.remove('hidden');
        }
        function finishQuiz() {
            state.quizAnswers.completed = true;
            localStorage.setItem('klarka_quiz', JSON.stringify(state.quizAnswers));
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('quiz-score').textContent = `${state.quizAnswers.score}%`;
            document.getElementById('cert-date').textContent = new Date().toLocaleDateString('cs-CZ');
            document.getElementById('certificate-screen').style.display = 'flex';
        }

        // --- APP NAVIGATION ---
        function showMainApp() {
            document.getElementById('certificate-screen').style.display = 'none';
            const app = document.getElementById('app-interface');
            app.classList.remove('hidden');
            setTimeout(() => app.classList.remove('opacity-0'), 10);
            renderChannels();
            switchChannel('welcome');
            updateBookmarkCounter();
        }
        function renderChannels() {
            const container = document.getElementById('channels-container');
            container.innerHTML = `
                <div class="px-2 mb-4"><div class="flex justify-between px-2 text-xs font-bold text-[var(--interactive-normal)] uppercase mb-1">Informace</div><div onclick="switchChannel('welcome')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-door-open text-gray-500"></i> uvÃ­tÃ¡nÃ­</div><div onclick="switchChannel('timeline')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-history text-gray-500"></i> timeline</div></div>
                <div class="px-2 mb-4"><div class="flex justify-between px-2 text-xs font-bold text-[var(--interactive-normal)] uppercase mb-1">Knihovna</div><div onclick="switchChannel('manual')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-book text-[var(--green)]"></i> nÃ¡vod</div><div onclick="switchChannel('movies')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-film text-[var(--yellow)]"></i> filmy</div><div onclick="switchChannel('series')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-tv text-[#5865F2]"></i> seriÃ¡ly</div><div onclick="switchChannel('games')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-gray-300 hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-gamepad text-[var(--green)]"></i> hry</div><div onclick="showWatchlist()" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-[var(--pink)] hover:bg-[#393c43] flex items-center gap-2 cursor-pointer"><i class="fas fa-bookmark text-[var(--pink)]"></i> tvÅ¯j-watchlist</div></div>
                <div class="px-2 mb-4"><div class="flex justify-between px-2 text-xs font-bold text-[var(--interactive-normal)] uppercase mb-1">DÅ¯leÅ¾itÃ©</div><div onclick="switchChannel('upgrade')" class="channel-item px-2 py-1.5 rounded mx-2 mb-1 text-[var(--yellow)] hover:bg-[#faa61a] hover:text-black flex items-center gap-2 cursor-pointer pulse-glow"><i class="fas fa-file-alt text-[var(--yellow)]"></i> README.md</div></div>
            `;
        }
        function switchChannel(channel) {
            document.querySelectorAll('.channel-item').forEach(el => el.classList.remove('bg-[#393c43]', 'text-white'));
            const clicked = Array.from(document.querySelectorAll('.channel-item')).find(el => el.getAttribute('onclick').includes(channel));
            if(clicked) clicked.classList.add('bg-[#393c43]', 'text-white');
            state.currentChannel = channel;
            
            const titles = {'welcome':'uvÃ­tÃ¡nÃ­','manual':'nÃ¡vod','timeline':'timeline','movies':'filmy','series':'seriÃ¡ly','games':'hry','upgrade':'README.md'};
            const icons = {'welcome':'fa-door-open','manual':'fa-book','timeline':'fa-history','movies':'fa-film','series':'fa-tv','games':'fa-gamepad','upgrade':'fa-file-alt'};
            document.getElementById('channel-name').textContent = titles[channel];
            document.getElementById('channel-icon').className = `fas ${icons[channel]} text-gray-500 text-xl mr-2`;
            document.getElementById('user-status').textContent = channel === 'upgrade' ? 'PÅ™emÃ½Å¡lÃ­ o upgradu' : 'Online';
            
            const container = document.getElementById('messages-container');
            container.innerHTML = '';
            
            if(channel === 'welcome') renderWelcome();
            else if (channel === 'manual') renderManual();
            else if (channel === 'timeline') renderTimeline();
            else if (['movies','series','games'].includes(channel)) renderLibrary(channel);
            else if (channel === 'upgrade') {
                container.innerHTML = `<div class="flex gap-4 items-start"><img src="discord_profilovka.jpg" 
                 alt="JoÅ¾ka" 
                 class="w-10 h-10 rounded-full object-cover mt-1 shadow-md"><div class="flex-1"><div class="flex items-baseline gap-2"><span class="font-bold text-[var(--text-header)]">JoÅ¾ka</span></div><div onclick="startConfession()" class="mt-4 bg-[#2f3136] border border-[#292b2f] rounded p-3 flex items-center gap-3 w-full max-w-sm cursor-pointer hover:bg-[#36393f] transition group"><div class="file-icon-wrapper w-10 h-10 flex items-center justify-center text-4xl text-[#5865F2]"><i class="fas fa-file-code"></i></div><div class="flex-1 min-w-0"><div class="text-[#5865F2] font-medium truncate group-hover:underline text-sm">system_patch_v2.0.exe</div><div class="text-xs text-[#b9bbbe]">1.2 MB â€¢ Executable</div></div><div class="text-[#b9bbbe] hover:text-white transition text-lg"><i class="fas fa-download"></i></div></div></div></div>`;
            }
            // Add scroll to top logic for timeline as well
            if (['movies', 'series', 'games', 'manual', 'timeline'].includes(channel)) {
                container.scrollTop = 0;
            } else {
                container.scrollTop = container.scrollHeight;
            }
        }

        function renderWelcome() {
            const container = document.getElementById('messages-container');
            container.innerHTML = `
                <div class="flex gap-4 items-start">
                    <div class="w-10 h-10 rounded-full bg-[#5865F2] flex items-center justify-center text-white text-sm font-bold mt-1">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-baseline gap-2">
                            <span class="font-bold text-[var(--text-header)]">System Bot</span>
                            <span class="text-xs text-[var(--interactive-normal)]">Dnes v 22:15</span>
                        </div>
                        <div class="text-[var(--text-normal)] bg-[#2f3136] p-4 rounded-lg mt-2 shadow-sm">
                            <p class="font-bold text-[var(--text-header)] mb-2">VÃ­tej na serveru Kiscord, KlÃ¡rko! ğŸ„</p>
                            <p>TvÅ¯j status VrchnÃ­ho Fact-Checkera byl ÃºspÄ›Å¡nÄ› ovÄ›Å™en. Abys dokonÄila dneÅ¡nÃ­ misi, postupuj podle tohoto protokolu:</p>
                            <ul class="list-none pl-0 mt-3 space-y-2 text-sm">
                                <li><i class="fas fa-folder-open text-[var(--yellow)] mr-2"></i> <strong>#knihovna</strong> â€“ Projdi si mnou doporuÄenÃ© filmy, seriÃ¡ly a hry, rovnou je mÅ¯Å¾eÅ¡ stahovat.</li>
                                <li><i class="fas fa-hourglass-half text-[var(--blurple)] mr-2"></i> <strong>#timeline</strong> â€“ Synchronizuj si naÅ¡e spoleÄnÃ© vzpomÃ­nky a mÃ½ty.</li>
                                <li><i class="fas fa-scroll text-[var(--pink)] mr-2"></i> <strong>#README.md</strong> â€“ FinÃ¡lnÃ­ systÃ©movÃ½ log (otevÅ™Ã­t aÅ¾ po splnÄ›nÃ­ bodÅ¯ 1 a 2).</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4 items-start mt-6">
                    <img src="discord_profilovka.jpg" 
                        alt="JoÅ¾ka" 
                        class="w-10 h-10 rounded-full object-cover mt-1 shadow-md">
                    <div class="flex-1">
                        <div class="flex items-baseline gap-2">
                            <span class="font-bold text-[var(--text-header)] hover:underline cursor-pointer">JoÅ¾ka</span>
                            <span class="text-xs text-[var(--interactive-normal)]">PrÃ¡vÄ› teÄ</span>
                        </div>
                        <div class="text-[var(--text-normal)] mt-1">
                            <p>ÄŒus! Snad se ti tento zpÅ¯sob pÅ™edÃ¡nÃ­ dÃ¡rku lÃ­bÃ­ ğŸ….</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderManual() {
            const container = document.getElementById('messages-container');
            container.innerHTML = `
                <div class="flex gap-4 items-start"><img src="discord_profilovka.jpg" 
                 alt="JoÅ¾ka" 
                 class="w-10 h-10 rounded-full object-cover mt-1 shadow-md"><div class="flex-1"><div class="flex items-baseline gap-2"><span class="font-bold text-[var(--text-header)]">JoÅ¾ka</span><span class="text-xs text-[var(--interactive-normal)]">Pinned</span></div><div class="bg-gradient-to-br from-[#2f3136] to-[#202225] border-l-4 border-[#faa61a] p-4 rounded-r-lg mt-3"><h3 class="font-bold text-white text-lg mb-3 flex items-center gap-2"><i class="fas fa-graduation-cap text-[#faa61a]"></i> NÃ¡vod na stahovÃ¡nÃ­</h3><div class="space-y-4"><div class="flex gap-3"><div class="w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center text-white flex-shrink-0">1</div><div><p class="font-bold text-white">Instalace qBittorrent</p><p class="text-[var(--text-normal)] text-sm">StÃ¡hni si z <a href="https://www.qbittorrent.org/download.php" target="_blank" class="text-[#5865F2] hover:underline font-bold">qbittorrent.org/download</a>. Neboj, nenÃ­ to virus.</p></div></div><div class="flex gap-3"><div class="w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center text-white flex-shrink-0">2</div><div><p class="font-bold text-white">Magnet Link ğŸ§²</p><p class="text-[var(--text-normal)] text-sm">V knihovnÄ› klikni na ikonu stahovÃ¡nÃ­ u poloÅ¾ky. OtevÅ™e se ti to pÅ™Ã­mo v klientovi.</p></div></div><div class="flex gap-3"><div class="w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center text-white flex-shrink-0">3</div><div><p class="font-bold text-white">HDMI kabel (ten 5m)</p><p class="text-[var(--text-normal)] text-sm">PÅ™ipoj notebook k TV, zmÃ¡Äkni <code class="bg-black px-1 rounded text-white">Win + P</code> a vyber "Duplicate" nebo "Extend".</p></div></div></div></div></div></div>`;
        }
        function renderTimeline() {
            const container = document.getElementById('messages-container');
            container.innerHTML = `<div class="p-4"><h3 class="text-white font-bold text-lg mb-6 pl-4 border-l-4 border-[#5865F2]">NaÅ¡e SpoleÄnÃ¡ Cesta</h3><div class="relative pl-8 sm:pl-12"><div class="absolute left-[19px] top-0 bottom-0 w-0.5 bg-gradient-to-b from-[#5865F2] to-[#eb459e]"></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-shield-alt text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Kde to vÅ¡echno zaÄalo â€“ Clash Royale</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">Zeptal jsem se tÄ›, jestli nedÃ¡me 1v1 (samozÅ™ejmÄ› jsem vyhrÃ¡l). <br>(P.S. Ten deck si fakt uÅ¾ zmÄ›Åˆ, aÅ¥ mÃ¡Å¡ aspoÅˆ teoretickou Å¡anci.)</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#3ba55c] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-mobile-alt text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">NekoneÄnÃ½ Scroll & Teorie</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">Å est miliÃ³nÅ¯ poslanÃ½ch Reels a hodiny konverzacÃ­ o Å¾ivotÄ›. Jsi jedinÃ½ ÄlovÄ›k s dostateÄnÃ½m procesorovÃ½m vÃ½konem na to, aby pobral moje teorie (dÃ¡vÃ¡ to smysl?).</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#faa61a] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-graduation-cap text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Discord Maratony</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">271k+ hodin volÃ¡nÃ­. Od tvÃ© nekoneÄnÃ© trpÄ›livosti a obÄ›tavosti pÅ™i douÄovÃ¡nÃ­ mÃ©ho autistickÃ©ho ADHD mozku aÅ¾ po naÅ¡e bitvy ve Vyzyvateli, Tetrisu, Geoguessru, Fall Guys, Super Animal Royale a Minigolfu.</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#eb459e] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-fire text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">OhÃ½nek u VlÄnovskÃ½ch bÃºd</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">JÃ¡ sehnal dÅ™evo, ty jsi Å™Ã­dila. Pes nÃ¡m seÅ¾ral veÄeÅ™i, potkali jsme nÃ¡hodnÃ©ho HolanÄana a jÃ¡ nÃ¡s hrdinnÄ› brÃ¡nil sekerou proti dÅ™evÄ›nÃ© soÅ¡e (kterÃ¡ vypadala fakt podezÅ™ele!). PÅ™eÅ¾ili jsme.</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#ed4245] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-wine-glass text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Hody MaÅ™atice</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">VeÄer, kdy jsi mi zachrÃ¡nila prdel. DotÃ¡hla jsi mÄ› do auta, vyslechla si moje opileckÃ© ujiÅ¡Å¥ovÃ¡nÃ­, Å¾e fakt nejsem gej, a pak jsi jen sledovala mÅ¯j akrobatickÃ½ pÅ™eskok pÅ™es plot.</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-star text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">PoleÅ¡ovice</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">PrvnÃ­ jako skvÄ›lÃ½ navigÃ¡tor jsem vybral tu sprÃ¡vnou odboÄku/zkratku, abychom se mohli vyhnout hasiÄÅ¯m (predicted/foreshadowing). DÃ¡l moje perfektnÃ­ orientace ve tmÄ›, jeÅ¡tÄ› lepÅ¡Ã­ schopnost poznÃ¡vÃ¡nÃ­ hvÄ›zd (letadel) a vÃ½hled na poÅ¾Ã¡r pod nÃ¡mi. Tady jsi mÄ› poprvÃ© fact-checknula s Nerem a od tÃ© doby vÄ›Å™Ã­m mÃ½tÅ¯m.</p></div></div><div class="relative mb-10 max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-[#faa61a] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-basketball-ball text-white text-xs"></i></div><div class="bg-[#2f3136] p-4 rounded-lg ml-2 hover:bg-[#32353b] transition"><h4 class="font-bold text-white mb-1">Basketbal, ModrÃ¡ a Velehrad</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">PoprvÃ©, co jsem jÃ¡ Å™Ã­dil a mÃ¡lem nÃ¡s sejmul autobus. BasketbalovÃ½ zÃ¡pas, kde si borec zlomil nohu. Sidequest (jeÅ¡tÄ› s Elen) na Modrou na rozhlednu ve velkÃ© mlze a zimÄ›, potom dolÅ¯ na Velehrad v bahnÄ› do altÃ¡nku k rybnÃ­ku. Po vÃ­c jak hodinovÃ©m yappovÃ¡nÃ­ na parkoviÅ¡ti jsme zaÅ¡li na kebab, ale nemohli jsme si ho vychutnat kvÅ¯li cajtÅ¯m. SkvÄ›lÃ½ veÄer.</p></div></div><div class="relative max-w-2xl"><div class="absolute -left-[37px] top-0 w-8 h-8 rounded-full bg-gradient-to-r from-[#5865F2] to-[#eb459e] flex items-center justify-center z-10 border-4 border-[#36393f]"><i class="fas fa-gift text-white text-xs"></i></div><div class="bg-gradient-to-r from-[#2f3136] to-[#202225] p-4 rounded-lg border border-[#5865F2] ml-2"><h4 class="font-bold text-white mb-1">Tento dÃ¡rek</h4><p class="text-[var(--text-normal)] text-sm leading-relaxed">VÅ¡echny naÅ¡e vzpomÃ­nky na jednom mÃ­stÄ›. Diddyblud kalkulator a 5 metrÅ¯ HDMI kabelu (mÃ­sto maÅ¡le), abys mohla nastudovat vÅ¡echny moje filmovÃ© reference.</p></div></div></div></div>`;
        }

        function renderLibrary(type) {
            const container = document.getElementById('messages-container');
            const searchInput = document.getElementById('search-input');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            let items = library[type].filter(item => item.title.toLowerCase().includes(searchTerm));
            items.sort((a, b) => {
                const aB = state.watchlist.some(w => w.id === a.id);
                const bB = state.watchlist.some(w => w.id === b.id);
                return bB - aB;
            });

            const typeName = type === 'movies' ? 'filmy' : type === 'series' ? 'seriÃ¡ly' : 'hry';
            
            // Group by category if available, otherwise 'OstatnÃ­'
            const grouped = items.reduce((acc, item) => {
                const cat = item.cat || 'OstatnÃ­';
                if (!acc[cat]) acc[cat] = [];
                acc[cat].push(item);
                return acc;
            }, {});

            let html = `<div class="p-2 space-y-8">`; // Increased spacing between sections
            
            // Order categories for movies if present
            const categoryOrder = ["AnimÃ¡ky & PohÃ¡dky", "Komedie", "AkÄnÃ­ & Sci-Fi", "Drama & Thriller", "OstatnÃ­"];
            const sortedCategories = Object.keys(grouped).sort((a, b) => {
                return categoryOrder.indexOf(a) - categoryOrder.indexOf(b);
            });

            if (items.length === 0) {
                html += `<div class="text-gray-400 italic text-center mt-10">Nic nenalezeno... :(</div>`;
            } else {
                sortedCategories.forEach(cat => {
                    if (grouped[cat]) {
                        html += `
                            <div>
                                <h3 class="text-[var(--text-header)] font-bold mb-3 uppercase text-xs tracking-wide opacity-80 border-b border-[#2f3136] pb-1 ml-1">
                                    ${cat}
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        `;
                        grouped[cat].forEach(item => {
                            const isBookmarked = state.watchlist.some(w => w.id === item.id);
                            // Pink icon if bookmarked (#eb459e)
                            const bookmarkBtnClass = isBookmarked 
                                ? 'bg-[#2f3136] text-[#eb459e] hover:text-[#d4357e]' 
                                : 'bg-[#202225] text-gray-400 hover:text-[#eb459e]';
                            
                            html += `
                                <div class="bg-[#2f3136] p-3 rounded hover:bg-[#36393f] transition library-item flex justify-between items-center group ${isBookmarked ? 'border-l-2 border-[#eb459e]' : ''}">
                                    <div class="flex items-center gap-3 overflow-hidden">
                                        <span class="text-xl flex-shrink-0">${item.icon}</span>
                                        <span class="font-medium text-[var(--text-header)] truncate text-sm">${item.title}</span>
                                    </div>
                                    <div class="flex gap-2 flex-shrink-0 opacity-100 transition">
                                        <button onclick="toggleBookmark(${item.id}, '${type}')" class="w-8 h-8 rounded ${bookmarkBtnClass} flex items-center justify-center transition" title="PÅ™idat do watchlistu">
                                            <i class="${isBookmarked ? 'fas' : 'far'} fa-bookmark"></i>
                                        </button>
                                        <button onclick="initiateDownload(${item.id})" class="w-8 h-8 rounded bg-[#202225] flex items-center justify-center text-gray-400 hover:text-[#5865F2]" title="StÃ¡hnout">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                        html += `</div></div>`;
                    }
                });
            }
            
            html += `
                <div class="mt-8 p-4 bg-[#2f3136] rounded-lg border-l-4 border-[#5865F2] animate-fade-in">
                    <p class="text-sm text-[var(--text-normal)]">
                        <i class="fas fa-info-circle text-[#5865F2] mr-1"></i>
                        <strong>Tip:</strong> VÅ¡echny soubory seeduju (sdÃ­lÃ­m) z mÃ©ho PC. Klikni na <i class="fas fa-download mx-1"></i> a otevÅ™e se ti to rovnou v qBittorrentu. Rychlost by mÄ›la bÃ½t fajn!
                    </p>
                </div>
            </div>`;
            container.innerHTML = html;
        }

        function renderUpgrade() {
            const container = document.getElementById('messages-container');
            container.innerHTML = `<div class="flex gap-4 items-start"><img src="discord_profilovka.jpg" 
                 alt="JoÅ¾ka" 
                 class="w-10 h-10 rounded-full object-cover mt-1 shadow-md"><div class="flex-1"><div class="flex items-baseline gap-2"><span class="font-bold text-[var(--text-header)]">JoÅ¾ka</span></div><div onclick="startConfession()" class="mt-4 bg-[#2f3136] border border-[#292b2f] rounded p-3 flex items-center gap-3 w-full max-w-sm cursor-pointer hover:bg-[#36393f] transition group"><div class="file-icon-wrapper w-10 h-10 flex items-center justify-center text-4xl text-[#5865F2]"><i class="fas fa-file-code"></i></div><div class="flex-1 min-w-0"><div class="text-[#5865F2] font-medium truncate group-hover:underline text-sm">system_patch_v2.0.exe</div><div class="text-xs text-[#b9bbbe]">1.2 MB â€¢ Executable</div></div><div class="text-[#b9bbbe] hover:text-white transition text-lg"><i class="fas fa-download"></i></div></div></div></div>`;
        }

        // --- WATCHLIST LOGIC ---
        function toggleBookmark(id, type) {
            let item;
            for(let k in library) { item = library[k].find(i => i.id === id); if(item) { item.type = type; break; } }
            const idx = state.watchlist.findIndex(w => w.id === id);
            if(idx === -1) { state.watchlist.push(item); showNotification('PÅ™idÃ¡no', 'success'); }
            else { state.watchlist.splice(idx, 1); showNotification('OdebrÃ¡no', 'info'); }
            localStorage.setItem('klarka_watchlist', JSON.stringify(state.watchlist));
            updateBookmarkCounter();
            if(['movies','series','games'].includes(state.currentChannel)) renderLibrary(state.currentChannel);
        }
        function updateBookmarkCounter() {
            const count = state.watchlist.length;
            document.getElementById('bookmark-count').textContent = count;
            document.getElementById('bookmark-counter').style.display = count > 0 ? 'flex' : 'none';
        }
        function showWatchlist() {
            document.getElementById('watchlist-modal').style.display = 'flex';
            const container = document.getElementById('watchlist-items');
            document.getElementById('watchlist-total').textContent = state.watchlist.length;
            if(state.watchlist.length === 0) container.innerHTML = '<div class="text-center text-gray-500 py-10">PrÃ¡zdno.</div>';
            else container.innerHTML = state.watchlist.map(i => `<div class="bg-[#2f3136] p-3 rounded flex justify-between items-center mb-2"><div class="flex items-center gap-3"><span class="text-xl">${i.icon}</span><span class="text-white">${i.title}</span></div><button onclick="toggleBookmark(${i.id},'${i.type}');showWatchlist()" class="text-[#ed4245]"><i class="fas fa-trash"></i></button></div>`).join('');
        }
        function clearWatchlist() {
            if(confirm('VyÄistit?')) { state.watchlist = []; localStorage.setItem('klarka_watchlist', '[]'); showWatchlist(); updateBookmarkCounter(); if(['movies','series','games'].includes(state.currentChannel)) renderLibrary(state.currentChannel); showNotification('Watchlist vyÄiÅ¡tÄ›n', 'info'); }
        }
        function exportWatchlist() {
            if(state.watchlist.length === 0) { showNotification('Watchlist je prÃ¡zdnÃ½!', 'warning'); return; }
            const listText = state.watchlist.map(item => `â€¢ ${item.title} (${item.type === 'movies' ? 'Film' : item.type === 'series' ? 'SeriÃ¡l' : 'Hra'})`).join('\n');
            const fullText = `ğŸ§¾ NÃÅ  SPOLEÄŒNÃ WATCHLIST\n\n${listText}\n\nğŸ“… VytvoÅ™eno: ${new Date().toLocaleDateString('cs-CZ')}\nâ¤ï¸ TÄ›Å¡Ã­m se na spoleÄnÃ© sledovÃ¡nÃ­!`;
            const fallbackCopy = (text) => { const textArea = document.createElement("textarea"); textArea.value = text; document.body.appendChild(textArea); textArea.select(); try { document.execCommand('copy'); showNotification('Watchlist zkopÃ­rovÃ¡n do schrÃ¡nky!', 'success'); } catch (err) { showNotification('NepodaÅ™ilo se zkopÃ­rovat text', 'error'); } document.body.removeChild(textArea); };
            if (navigator.clipboard && navigator.clipboard.writeText) navigator.clipboard.writeText(fullText).then(() => showNotification('Watchlist zkopÃ­rovÃ¡n do schrÃ¡nky!', 'success')).catch(() => fallbackCopy(fullText));
            else fallbackCopy(fullText);
        }
        function showNotification(msg, type) {
            const div = document.createElement('div'); div.className = `fixed top-4 right-4 text-white px-4 py-2 rounded shadow-lg z-[100] ${type==='success'?'bg-[#3ba55c]':'bg-[#5865F2]'}`;
            div.innerHTML = msg; document.body.appendChild(div); setTimeout(()=>div.remove(), 3000);
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        // --- DOWNLOAD ---
        function initiateDownload(id) {
            let item = null;
            for (const category in library) { const found = library[category].find(i => i.id === id); if (found) { item = found; break; } }
            if (!item) return;
            state.currentDownload = item;
            document.getElementById('download-message').textContent = `StÃ¡hnout "${item.title}"?`;
            document.getElementById('download-modal').style.display = 'flex';
        }

        function openMagnetLink() { 
            if (state.currentDownload && state.currentDownload.magnet) {
                // TÃ­mto Å™Ã¡dkem skuteÄnÄ› "proklikneÅ¡" magnet link
                window.location.href = state.currentDownload.magnet;
                showNotification('SpouÅ¡tÃ­m qBittorrent...', 'success'); 
            } else {
                showNotification('Magnet link nenalezen.', 'error');
            }
            closeModal('download-modal'); 
}
        function openGoogleDrive() { 
    if (state.currentDownload && state.currentDownload.gdrive && state.currentDownload.gdrive !== "") {
        // OtevÅ™e odkaz na Google Drive v novÃ©m oknÄ›/panelu
        window.open(state.currentDownload.gdrive, '_blank');
        showNotification('OtevÃ­rÃ¡m Google Drive...', 'success'); 
    } else {
        // Pokud odkaz v datech chybÃ­, upozornÃ­me uÅ¾ivatele
        showNotification('Odkaz na Google Drive nenÃ­ k dispozici.', 'info');
    }
    closeModal('download-modal'); 
}

        // --- CONFESSION ---
        function startConfession() {
            // Play music 1
            const music1 = document.getElementById('audio-final-countdown');
            if(music1) {
                music1.currentTime = 0;
                music1.volume = 0.5;
                music1.play().catch(e => console.log("Audio play failed (user interaction needed first):", e));
            }

            const modal = document.getElementById('confession-modal');
            const output = document.getElementById('terminal-output');
            const typingArea = document.getElementById('typing-area');
            const promptText = document.getElementById('prompt-text');
            const cmdCursor = document.getElementById('cmd-cursor');
            modal.style.display = 'flex';
            output.innerHTML = `<div>Microsoft Windows [Version 10.0.19045]</div><div>(c) Microsoft Corporation. All rights reserved.</div><br>`;
            typingArea.textContent = '';
            promptText.textContent = "C:\\Users\\KlÃ¡rka\\Heart>";
            cmdCursor.style.display = 'inline-block';
            const command = " system_patch_v2.0.exe";
            let charIndex = 0;
            const lines = ["Loading shared memory database...", "âœ“ Discord logs... OK", "âœ“ Co-op games... OK", "âœ“ Inside jokes... OK", "Running compatibility analysis...", ">> Humor: MATCH", ">> Values: SYNCED", "Tetris Logic: Perfect fit detected.", "Analysis complete.", "Decrypting final message..."];
            
            function typeCommand() {
                if (charIndex < command.length) { typingArea.textContent += command.charAt(charIndex); charIndex++; setTimeout(typeCommand, Math.random() * 50 + 50); } 
                else setTimeout(runLogs, 500);
            }
            function runLogs() {
                const cmdLine = document.createElement('div');
                cmdLine.innerHTML = `C:\\Users\\KlÃ¡rka\\Heart&gt;${command}`;
                output.appendChild(cmdLine);
                typingArea.textContent = ''; promptText.textContent = ''; cmdCursor.style.display = 'none';
                let lineIndex = 0;
                function printLine() {
                    if (lineIndex < lines.length) {
                        const div = document.createElement('div');
                        div.textContent = lines[lineIndex];
                        output.appendChild(div);
                        document.getElementById('terminal-body').scrollTop = document.getElementById('terminal-body').scrollHeight;
                        lineIndex++;
                        if(lineIndex === lines.length) {
                             const cursorSpan = document.createElement('span');
                             cursorSpan.className = 'cmd-cursor';
                             cursorSpan.innerText = ' '; // spacer
                             const pressKey = document.createElement('span');
                             pressKey.className = 'animate-pulse text-gray-500 ml-2';
                             pressKey.innerText = 'Press any key to continue...';
                             
                             const lastLine = document.createElement('div');
                             lastLine.appendChild(pressKey);
                             lastLine.appendChild(cursorSpan);
                             output.appendChild(lastLine);
                             
                             const proceed = () => {
                                document.removeEventListener('keydown', proceed);
                                document.removeEventListener('click', proceed);
                                document.getElementById('confession-modal').style.display = 'none';
                                
                                // Switch Music
                                const music1 = document.getElementById('audio-final-countdown');
                                const music2 = document.getElementById('audio-divka');
                                if(music1) {
                                    // Simple fade out logic could go here, but pause is safer for stability
                                    music1.pause();
                                }
                                if(music2) {
                                    music2.currentTime = 0;
                                    music2.volume = 0.5;
                                    music2.play().catch(e => console.log("Audio 2 play failed:", e));
                                }

                                const finalModal = document.getElementById('final-confession-modal');
                                const modalBox = document.getElementById('final-modal-box');
                                
                                document.getElementById('typing-container').innerHTML = '';
                                document.getElementById('confession-buttons').classList.add('hidden');
                                
                                finalModal.style.display = 'flex';
                                
                                setTimeout(() => {
                                    modalBox.classList.remove('opacity-0', 'scale-95');
                                    modalBox.classList.add('opacity-100', 'scale-100');
                                    setTimeout(typeFinalMessage, 500);
                                }, 50);
                             };
                             
                             // Add listeners with a small delay to prevent accidental double clicks
                             setTimeout(() => {
                                document.addEventListener('keydown', proceed);
                                document.addEventListener('click', proceed);
                             }, 500);
                        } else setTimeout(printLine, 400 + Math.random() * 400);
                    }
                }
                printLine();
            }
            typeCommand();
        }

        function typeFinalMessage() {
            const container = document.getElementById('typing-container');
            container.innerHTML = '';
            document.getElementById('confession-buttons').classList.add('hidden');
            
            const textParts = [
                { text: "KlÃ¡rko,", bold: true },
                { text: "hroznÄ› si vÃ¡Å¾Ã­m toho, co mezi sebou mÃ¡me. MÃ¡me podobnÃ© hodnoty, ve vÅ¡em si rozumÃ­me a jsi neuvÄ›Å™itelnÄ› inteligentnÃ­ a klidnÃ¡." },
                { text: "HlavnÄ› jsi ale ÄlovÄ›k, se kterÃ½m mÅ¯Å¾u bÃ½t naprosto sÃ¡m sebou, protoÅ¾e vÃ­m, Å¾e mÄ› bereÅ¡ pÅ™esnÄ› takovÃ©ho, jakÃ½ jsem." },
                { text: "MÃ¡m tÄ› hroznÄ› rÃ¡d.", highlight: true },
                { text: "NaÅ¡e pÅ™Ã¡telstvÃ­ pro mÄ› znamenÃ¡ straÅ¡nÄ› moc a nikdy o nÄ›j nechci pÅ™ijÃ­t. ZÃ¡roveÅˆ ale cÃ­tÃ­m, Å¾e k tobÄ› mÃ¡m mnohem blÃ­Å¾, a byl bych moc rÃ¡d, kdybychom to spolu zkusili i jako pÃ¡r." },
                { text: "NechtÄ›la bys to se mnou zkusit?", bold: true, center: true }
            ];
            
            let partIndex = 0;
            let charIndex = 0;
            let currentP = null;
            
            function typeChar() {
                if (partIndex >= textParts.length) {
                    setTimeout(() => {
                        const btns = document.getElementById('confession-buttons');
                        btns.classList.remove('hidden');
                        btns.classList.add('animate-fade-in');
                    }, 500);
                    return;
                }
                
                const part = textParts[partIndex];
                
                if (!currentP) {
                    currentP = document.createElement('p');
                    if (part.bold) currentP.className = "font-bold text-white text-lg";
                    if (part.highlight) currentP.className = "text-[#eb459e] font-bold text-center text-xl my-2";
                    if (part.center) currentP.className = "font-bold text-white text-center mt-4 text-lg";
                    currentP.classList.add('typing-cursor');
                    container.appendChild(currentP);
                }
                
                if (charIndex < part.text.length) {
                    currentP.textContent = part.text.substring(0, charIndex + 1);
                    charIndex++;
                    setTimeout(typeChar, 60); // Faster typing speed per char
                } else {
                    currentP.classList.remove('typing-cursor');
                    currentP = null;
                    charIndex = 0;
                    partIndex++;
                    setTimeout(typeChar, 600); // Shorter pause between lines
                }
            }
            
            typeChar();
        }

        function responseYes() { 
            document.getElementById('final-modal-content').innerHTML = `
                <div class="animate-fade-in">
                    <h2 class="text-3xl font-bold text-[#eb459e] mb-2">â¤ï¸ CONNECTION ESTABLISHED! â¤ï¸</h2>
                    <p class="text-gray-300 text-lg leading-relaxed mb-6">
                        DÄ›kuju, Å¾e jsi mi dala Å¡anci. Jsi moje kotva v celÃ©m tom mÃ©m chaosu a slibuju, Å¾e si toho budu vÃ¡Å¾it kaÅ¾dÃ½ den.
                        <br><br>
                        TÄ›Å¡Ã­m se na vÅ¡echno, co nÃ¡s ÄekÃ¡.
                    </p>
                    <div class="mt-8">
                        <button onclick="planDate()" class="w-full bg-gradient-to-r from-[#eb459e] to-[#5865F2] hover:opacity-90 text-white py-4 rounded-lg font-bold text-xl shadow-lg transition transform hover:scale-105">
                            NaplÃ¡novat rande
                        </button>
                    </div>
                </div>
            `;
        }
        function responseNo() { 
            document.getElementById('final-modal-content').innerHTML = `
                <div class="animate-fade-in">
                    <h2 class="text-2xl font-bold text-white mb-4">DÃ­ky za upÅ™Ã­mnost, KlÃ¡rko.</h2>
                    <p class="text-gray-300 text-lg mb-6 leading-relaxed">
                        Moc si tÄ› vÃ¡Å¾Ã­m a jsem rÃ¡d, Å¾e si mÅ¯Å¾eme dÃ¡l zÅ¯stat blÃ­zcÃ­ tak, jak jsme.
                        <br><br>
                        Nic se nemÄ›nÃ­ â€“ dÃ¡l budeme yappovat o teoriÃ­ch a hrÃ¡t Tetris. ğŸ˜Š
                    </p>
                    <button onclick="closeModal('final-confession-modal')" class="w-full bg-[#5865F2] hover:bg-[#4752c4] text-white py-3 rounded-lg font-bold transition">
                        ZpÄ›t na server
                    </button>
                </div>
            `; 
        }

        function planDate() {
            const modal = document.getElementById('final-confession-modal');
            const modalBox = document.getElementById('final-modal-box'); // Use the inner box for content replacement
            
            // Create content HTML
            const content = `
                <div class="animate-fade-in">
                    <div class="text-4xl mb-2">ğŸ“…</div>
                    <h2 class="text-xl font-bold text-white mb-4">PlÃ¡novaÄ Rande v1.0</h2>
                    <div class="space-y-4 text-left">
                        <div>
                            <label class="block text-[#b9bbbe] text-xs font-bold uppercase mb-1">Kdy mÃ¡Å¡ Äas?</label>
                            <select id="date-select" class="w-full bg-[#202225] text-white p-2.5 rounded border border-[#202225] focus:border-[#5865F2] focus:outline-none transition">
                                <option value="Co nejdÅ™Ã­ve">Co nejdÅ™Ã­ve! ğŸš€</option>
                                <option value="Tento vÃ­kend">Tento vÃ­kend</option>
                                <option value="PÅ™Ã­Å¡tÃ­ tÃ½den">PÅ™Ã­Å¡tÃ­ tÃ½den</option>
                                <option value="Po zkouÅ¡kÃ¡ch">AÅ¾ po zkouÅ¡kÃ¡ch</option>
                                <option value="Jindy">Jindy (napiÅ¡u ti)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[#b9bbbe] text-xs font-bold uppercase mb-1">Co podnikneme?</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button type="button" onclick="selectActivity(this, 'Kino')" class="activity-btn bg-[#2f3136] hover:bg-[#40444b] text-white p-3 rounded text-sm font-medium transition border border-transparent hover:border-[#5865F2]">Kino ğŸ¿</button>
                                <button type="button" onclick="selectActivity(this, 'KavÃ¡rna')" class="activity-btn bg-[#2f3136] hover:bg-[#40444b] text-white p-3 rounded text-sm font-medium transition border border-transparent hover:border-[#5865F2]">KavÃ¡rna â˜•</button>
                                <button type="button" onclick="selectActivity(this, 'ProchÃ¡zka')" class="activity-btn bg-[#2f3136] hover:bg-[#40444b] text-white p-3 rounded text-sm font-medium transition border border-transparent hover:border-[#5865F2]">ProchÃ¡zka ğŸŒ²</button>
                                <button type="button" onclick="selectActivity(this, 'Chill')" class="activity-btn bg-[#2f3136] hover:bg-[#40444b] text-white p-3 rounded text-sm font-medium transition border border-transparent hover:border-[#5865F2]">Chill u mÄ› ğŸ®</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-[#b9bbbe] text-xs font-bold uppercase mb-1">Detaily / PoznÃ¡mka</label>
                            <textarea id="custom-note" class="w-full bg-[#202225] text-white p-2.5 rounded border border-[#202225] focus:border-[#5865F2] focus:outline-none transition text-sm h-20 resize-none" placeholder="NapÅ™. na co mÃ¡Å¡ chuÅ¥, jakÃ½ film..."></textarea>
                        </div>
                    </div>
                    <button onclick="confirmDate()" class="mt-6 w-full bg-[#5865F2] hover:bg-[#4752c4] text-white py-3 rounded font-bold transition transform active:scale-95 shadow-md"><i class="fas fa-paper-plane mr-2"></i> Odeslat nÃ¡vrh</button>
                </div>
            `;
            
            // Replace only content inside the box
            document.getElementById('final-modal-content').innerHTML = content;
        }
        function selectActivity(btn, act) {
            document.querySelectorAll('.activity-btn').forEach(b => { b.classList.remove('bg-[#5865F2]', 'border-[#5865F2]', 'selected'); b.classList.add('bg-[#2f3136]'); });
            btn.classList.remove('bg-[#2f3136]'); btn.classList.add('bg-[#5865F2]', 'selected'); btn.dataset.value = act;
        }
        function confirmDate() {
            const date = document.getElementById('date-select').value;
            const actBtn = document.querySelector('.activity-btn.selected');
            const activity = actBtn ? actBtn.dataset.value : "NÄ›co vymyslÃ­me";
            const note = document.getElementById('custom-note').value;
            const message = `ğŸ“… **NÃVRH RANDE**\n\nğŸ•’ **Kdy:** ${date}\nğŸ­ **Co:** ${activity}\nğŸ“ **PoznÃ¡mka:** ${note || "Bez poznÃ¡mky"}\n\n*OdeslÃ¡no z Kiscordu*`;
            const fallbackCopy = (text) => {
                const textArea = document.createElement("textarea"); textArea.value = text; document.body.appendChild(textArea); textArea.select();
                try { document.execCommand('copy'); showRedirect(); } catch (err) { showNotification('Chyba', 'error'); }
                document.body.removeChild(textArea);
            };
            if (navigator.clipboard && navigator.clipboard.writeText) navigator.clipboard.writeText(message).then(showRedirect).catch(() => fallbackCopy(message));
            else fallbackCopy(message);
        }
        function showRedirect() { document.getElementById('final-confession-modal').style.display = 'none'; document.getElementById('redirect-modal').style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function showNotification(msg, type) {
            const div = document.createElement('div'); div.className = `fixed top-4 right-4 text-white px-4 py-2 rounded shadow-lg z-[100] ${type==='success'?'bg-[#3ba55c]':'bg-[#5865F2]'}`;
            div.innerHTML = msg; document.body.appendChild(div); setTimeout(()=>div.remove(), 3000);
        }

        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if(e.key === 'Enter' && e.target.value.startsWith('/')) {
                const cmd = e.target.value.trim();
                if(cmd === '/sova') showNotification('ğŸ¦‰ Sovy otoÄÃ­ hlavu o 270Â°!', 'info');
                else if(cmd === '/chobotnice') showNotification('ğŸ™ Chobotnice majÃ­ modrou krev.', 'info');
                e.target.value = '';
            }
        });
        
        // MISSING FUNCTIONS RESTORED
        function inviteFriend() {
            const tempInput = document.createElement("input");
            tempInput.value = "https://kiscord.gg/invite/podoli-is-fake";
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
            showNotification("Invite link zkopÃ­rovÃ¡n! (Je to jen vtip)", "success");
        }

        function changeTheme(theme) {
            const root = document.documentElement;
            // Clear inline styles first (font-family, font-size from Tetris)
            document.body.style.fontFamily = '';
            document.body.style.fontSize = '';
            
            if (theme === 'christmas') { 
                root.style.setProperty('--bg-tertiary', '#420d0d'); 
                root.style.setProperty('--bg-secondary', '#5c1414'); 
                root.style.setProperty('--bg-primary', '#240a0a'); 
                root.style.setProperty('--blurple', '#c92a2a'); // Red
                root.style.setProperty('--green', '#ffd700'); // Gold
                root.style.setProperty('--text-header', '#ffffff');
                root.style.setProperty('--interactive-active', '#ffffff');
                root.style.setProperty('--interactive-normal', '#e8e8e8'); // Lighter text
                root.style.setProperty('--text-normal', '#f0f0f0');
            } 
            else if (theme === 'tetris') {
                root.style.setProperty('--bg-tertiary', '#0d0e15');
                root.style.setProperty('--bg-secondary', '#151620');
                root.style.setProperty('--bg-primary', '#1c1d29');
                root.style.setProperty('--blurple', '#00e5ff'); 
                root.style.setProperty('--green', '#69f0ae'); 
                root.style.setProperty('--red', '#ff5252'); 
                root.style.setProperty('--yellow', '#ffd740'); 
                root.style.setProperty('--pink', '#e040fb'); 
                root.style.setProperty('--text-normal', '#33ff00');
                root.style.setProperty('--interactive-normal', '#33ff00');
                document.body.style.fontFamily = "'Press Start 2P', cursive"; 
                document.body.style.fontSize = "0.8rem";
            }
            else { // default
                root.style.setProperty('--bg-tertiary', '#202225'); root.style.setProperty('--bg-secondary', '#2f3136'); root.style.setProperty('--bg-primary', '#36393f'); 
                root.style.setProperty('--blurple', '#5865F2');
                root.style.setProperty('--green', '#3ba55c');
                root.style.setProperty('--red', '#ed4245');
                root.style.setProperty('--yellow', '#faa61a');
                root.style.setProperty('--pink', '#eb459e');
                root.style.setProperty('--text-normal', '#dcddde');
                root.style.setProperty('--interactive-normal', '#b9bbbe');
            }
            showNotification(`TÃ©ma zmÄ›nÄ›no: ${theme}`, 'success');
        }

        // INIT
        if(state.quizAnswers.completed) { document.getElementById('login-screen').style.display = 'none'; showMainApp(); }
        const search = document.getElementById('search-input');
        if (search) search.addEventListener('input', () => { if (['movies', 'series', 'games'].includes(state.currentChannel)) renderLibrary(state.currentChannel); });
    </script>
</body>
</html>